<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Drag & Drop Vocabulary Match Game</title>

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Nico+Moji&display=swap" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Comic Neue', cursive;
    background: #f0f0f0;
    margin: 0; padding: 1rem;
    color: #333;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode {
    background-color: #121212;
    color: #ddd;
  }
  h1 {
    text-align: center;
    color: #00695c;
  }
  #dark-mode-toggle {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #00796b;
    color: white;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 18px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s;
    user-select: none;
  }
  #dark-mode-toggle:hover {
    background-color: #004d40;
  }
  .hidden {
    display: none;
  }

  /* Start screen */
  #start-screen {
    max-width: 600px;
    margin: 0 auto 2rem;
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  }
  #start-screen.dark-mode {
    background: #1f1f1f;
    box-shadow: 0 2px 12px rgba(0,0,0,0.9);
  }
  #player-name {
    width: 80%;
    font-size: 1rem;
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid #aaa;
    font-family: 'Comic Neue', cursive;
    outline: none;
    margin-bottom: 1rem;
    transition: border-color 0.3s;
  }
  #player-name:focus {
    border-color: #00796b;
  }
  .set-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.7rem;
    justify-content: center;
  }
  .set-buttons button {
    padding: 0.6rem 1.2rem;
    background: #00796b;
    color: white;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-family: 'Comic Neue', cursive;
    transition: background-color 0.3s, transform 0.2s;
  }
  .set-buttons button:hover {
    background-color: #004d40;
    transform: scale(1.05);
  }

  /* Game screen */
  #game-screen {
    max-width: 700px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    user-select: none;
  }
  #game-screen.dark-mode {
    background: #1f1f1f;
    box-shadow: 0 2px 12px rgba(0,0,0,0.9);
  }

  #progress-container {
    width: 80%;
    height: 20px;
    background: #ddd;
    border-radius: 10px;
    margin: 0 auto 0.5rem auto;
    overflow: hidden;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
  }
  body.dark-mode #progress-container {
    background: #333;
    box-shadow: inset 0 0 5px rgba(255,255,255,0.1);
  }
  #progress-bar {
    height: 100%;
    width: 100%;
    background-color: #00796b;
    transition: width 1s linear;
  }
  body.dark-mode #progress-bar {
    background-color: #4caf50;
  }

  #timer {
    font-family: 'Nico Moji', monospace;
    font-weight: bold;
    font-size: 1.3rem;
    text-align: center;
    margin-bottom: 1rem;
    color: #004d40;
    transition: color 0.3s;
  }
  body.dark-mode #timer {
    color: #a5d6a7;
  }
  #timer.pulse {
    animation: pulseRed 1s infinite alternate;
    color: #e53935 !important;
  }
  @keyframes pulseRed {
    0% { color: #004d40; }
    100% { color: #e53935; }
  }

  #score-container {
    font-weight: bold;
    font-size: 1.4rem;
    color: #2e7d32;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 1rem;
  }
  body.dark-mode #score-container {
    color: #a5d6a7;
  }
  #money-amount {
    font-size: 1.6rem;
    color: #f9a825;
  }
  #piggy-bank {
    width: 60px;
    height: 50px;
    transition: transform 0.3s ease;
  }

  #word-lists {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 2rem;
    margin-top: 1rem;
  }

  /* Drop zones for English words */
  .drop-zone {
    flex: 1 1 45%;
    min-height: 320px;
    background: #a2cfc4;
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    overflow-y: auto;
  }
  body.dark-mode .drop-zone {
    background: #225544;
    box-shadow: 0 0 8px rgba(255,255,255,0.1);
  }

  .drop-zone h3 {
    margin: 0 0 10px 0;
    font-family: 'Comic Neue', cursive;
  }

  /* Draggable vocab words (Japanese) */
  .vocab-word {
    background: #d0e8e4;
    padding: 8px 12px;
    margin: 6px 0;
    border-radius: 10px;
    cursor: grab;
    user-select: none;
    font-family: 'Nico Moji', monospace;
    font-size: 1.2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    transition: background-color 0.3s;
  }
  .vocab-word.dragging {
    opacity: 0.5;
  }
  body.dark-mode .vocab-word {
    background: #336655;
    box-shadow: 0 2px 4px rgba(0,0,0,0.6);
  }

  /* English word targets */
  .target-word {
    background: #f4f4f4;
    padding: 10px 14px;
    margin: 8px 0;
    border-radius: 12px;
    border: 2px dashed #00796b;
    min-height: 42px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Comic Neue', cursive;
    transition: background-color 0.3s, border-color 0.3s;
    user-select: none;
  }
  .target-word.correct {
    background-color: #a5d6a7;
    border-color: #2e7d32;
    color: #2e7d32;
  }
  .target-word.incorrect {
    animation: shake 0.5s;
    border-color: #e53935;
  }
  body.dark-mode .target-word {
    background: #224433;
    border-color: #4caf50;
    color: #a5d6a7;
  }
  body.dark-mode .target-word.correct {
    background-color: #4caf50;
    border-color: #2e7d32;
    color: #1b3d1a;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-8px); }
    40%, 80% { transform: translateX(8px); }
  }

  /* Coin animation */
  .coin {
    position: fixed;
    width: 25px;
    height: 25px;
    background: radial-gradient(circle at 12px 12px, #ffd700 0%, #b8860b 100%);
    border-radius: 50%;
    box-shadow: inset 0 0 8px #fff700;
    pointer-events: none;
    animation: fallCoin 1s ease forwards;
    z-index: 1000;
  }
  @keyframes fallCoin {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateY(180px) scale(0.3); opacity: 0; }
  }
</style>
</head>
<body>

<div id="dark-mode-toggle" title="Toggle Dark Mode">🌙</div>

<div id="start-screen" aria-label="Start screen">
  <h1>Vocabulary Match Game</h1>
  <input type="text" id="player-name" placeholder="Enter your name..." autocomplete="off" aria-label="Player name" />
  <div class="set-buttons" id="set-buttons" aria-label="Select vocabulary set"></div>
</div>

<div id="game-screen" class="hidden" aria-live="polite" aria-label="Game screen">
  <div id="progress-container" aria-label="Time progress">
    <div id="progress-bar"></div>
  </div>
  <div id="timer">Time: 05:00</div>
  <div id="score-container" aria-live="polite">
    Money: <span id="money-amount">¥0</span>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Piggy_bank_icon.svg/64px-Piggy_bank_icon.svg.png" id="piggy-bank" alt="Piggy bank" />
  </div>
  <div id="word-lists">
    <div class="drop-zone" id="japanese-list" aria-label="Japanese words (draggable)">
      <h3>Japanese Words</h3>
    </div>
    <div class="drop-zone" id="english-list" aria-label="English words (drop targets)">
      <h3>English Words</h3>
    </div>
  </div>
</div>

<script>
  const vocabSets = {
    1: [
      {english:"minute", japanese:"分"},
      {english:"before", japanese:"の前に"},
      {english:"photography", japanese:"写真撮影"},
      {english:"tournament", japanese:"トーナメント"},
      {english:"against", japanese:"に対抗して"},
      {english:"lost", japanese:"負けった"},
      {english:"lose", japanese:"負ける"},
      {english:"final", japanese:"最後の"},
      {english:"second", japanese:"秒"},
      {english:"broke", japanese:"壊した"},
      {english:"surely", japanese:"確かに"},
      {english:"until", japanese:"。。。まで"},
      {english:"half", japanese:"半分の"},
      {english:"hour", japanese:"１時間"},
      {english:"tomorrow", japanese:"明日"},
      {english:"today", japanese:"今日"},
      {english:"yesterday", japanese:"昨日"},
      {english:"ago", japanese:"～前に"},
      {english:"spread", japanese:"広める"}
    ],
    2: [
      {english:"if", japanese:"もし"},
      {english:"plastic", japanese:"プラスチック"},
      {english:"exam", japanese:"テスト"},
      {english:"adventure", japanese:"冒険"},
      {english:"read", japanese:"読む"},
      {english:"main", japanese:"主な"},
      {english:"naughty", japanese:"いたずらな"},
      {english:"trouble", japanese:"心配、悩み、やっかいな事態"},
      {english:"lend", japanese:"貸す"},
      {english:"another", japanese:"もう一つの"}
    ],
    3: [
      {english:"think", japanese:"考える・思う"},
      {english:"author", japanese:"作者"},
      {english:"drew", japanese:"描いた"},
      {english:"scenery", japanese:"景色"},
      {english:"in fact", japanese:"今まで"},
      {english:"area", japanese:"地域"},
      {english:"still", japanese:"まだ"},
      {english:"hope", japanese:"望む"},
      {english:"someday", japanese:"いつか"},
      {english:"how", japanese:"どう"},
      {english:"borrow", japanese:"借りる"},
      {english:"fantasy", japanese:"ファンタジー"},
      {english:"message", japanese:"メッセージ"},
      {english:"horror", japanese:"ホラー"},
      {english:"novel", japanese:"小説"},
      {english:"mystery", japanese:"ミステリー"},
      {english:"encourage", japanese:"励ます"}
    ],
    4: [
      {english:"finish", japanese:"終わる"},
      {english:"training", japanese:"トレーニング"},
      {english:"perfect", japanese:"完璧"},
      {english:"learner", japanese:"学習者"},
      {english:"because", japanese:"だから・なので"},
      {english:"easy", japanese:"優しい・簡単な"},
      {english:"plus", japanese:"さらにその上"},
      {english:"teenager", japanese:"１０代の少年"},
      {english:"among", japanese:"の中に・の間に"},
      {english:"ending", japanese:"終わり"},
      {english:"town", japanese:"町"},
      {english:"witch", japanese:"魔女"}
    ],
    5: [
      {english:"famous", japanese:"有名"},
      {english:"dream", japanese:"夢"},
      {english:"build", japanese:"建てる"},
      {english:"tower", japanese:"塔"},
      {english:"around the world", japanese:"世界中"},
      {english:"world", japanese:"世界"},
      {english:"decide", japanese:"決める"},
      {english:"interest", japanese:"興味"},
      {english:"yourself", japanese:"あなた自身"},
      {english:"lots of", japanese:"たくさんの"},
      {english:"bake", japanese:"焼く"},
      {english:"more", japanese:"もっと"},
      {english:"perhaps", japanese:"多分"},
      {english:"bakery", japanese:"パン屋"},
      {english:"need", japanese:"必要"}
    ],
    6: [
      {english:"relax", japanese:"くつろぐ"},
      {english:"customer", japanese:"お客さん"},
      {english:"provide", japanese:"提供する"},
      {english:"several", japanese:"いくつかの"},
      {english:"that way", japanese:"そのようにして"},
      {english:"plenty", japanese:"十分な"},
      {english:"choice", japanese:"選択"},
      {english:"however", japanese:"しかしながら"},
      {english:"leftovers", japanese:"残り物・食べ残し"},
      {english:"away", japanese:"別の方向へ・わきへ"},
      {english:"throw away", japanese:"無駄に使う"},
      {english:"waste", japanese:"無駄"},
      {english:"discount", japanese:"割引"},
      {english:"enough", japanese:"十分な"},
      {english:"help", japanese:"助ける"}
    ],
    7: [
      {english:"pool", japanese:"プール"},
      {english:"over", japanese:"〜以上"},
      {english:"review", japanese:"見直す"},
      {english:"rule", japanese:"規則"},
      {english:"kitchen", japanese:"台所"},
      {english:"must", japanese:"〜しなければならない"},
      {english:"mask", japanese:"マスク"},
      {english:"smartphone", japanese:"スマートフォン"},
      {english:"back", japanese:"戻る"},
      {english:"return", japanese:"返す"},
      {english:"week", japanese:"週"},
      {english:"quiet", japanese:"静かな"},
      {english:"future", japanese:"未来"},
      {english:"in the future", japanese:"将来"},
      {english:"somewhere", japanese:"どこかに"},
      {english:"explore", japanese:"探検する"},
      {english:"clothes", japanese:"服"},
      {english:"design", japanese:"デザイン"},
      {english:"chef", japanese:"シェフ"}
    ],
    8: [
      {english:"as", japanese:"〜として"},
      {english:"behind", japanese:"後ろに"},
      {english:"cut down", japanese:"切り倒す"},
      {english:"building", japanese:"建物"},
      {english:"destroy", japanese:"破壊する"},
      {english:"shock", japanese:"ショック"},
      {english:"great", japanese:"素晴らしい"},
      {english:"like", japanese:"〜のような"},
      {english:"think", japanese:"考える"},
      {english:"rainforest", japanese:"熱帯雨林"},
      {english:"cutting", japanese:"切ること"},
      {english:"tree", japanese:"木"},
      {english:"really", japanese:"本当に"},
      {english:"clean", japanese:"きれいな"},
      {english:"save", japanese:"救う・保存する"},
      {english:"too much", japanese:"多すぎる"},
      {english:"need to", japanese:"〜しなければならない"},
      {english:"but", japanese:"しかし"},
      {english:"cause", japanese:"原因になる"},
      {english:"problem", japanese:"問題"}
    ],
    9: [
      {english:"bring", japanese:"持ってくる"},
      {english:"wait", japanese:"待つ"},
      {english:"tired", japanese:"疲れた"},
      {english:"bus stop", japanese:"バス停"},
      {english:"miss", japanese:"乗り遅れる"},
      {english:"catch", japanese:"間に合う・捕まえる"},
      {english:"morning", japanese:"朝"},
      {english:"first", japanese:"最初の"},
      {english:"train", japanese:"電車"},
      {english:"hope", japanese:"望む"},
      {english:"have to", japanese:"〜しなければならない"},
      {english:"forget", japanese:"忘れる"},
      {english:"key", japanese:"鍵"},
      {english:"door", japanese:"ドア"},
      {english:"close", japanese:"閉める"},
      {english:"bus", japanese:"バス"},
      {english:"stop", japanese:"止まる"},
      {english:"late", japanese:"遅い"}
    ],
    10: [
      {english:"listen", japanese:"聞く"},
      {english:"sound", japanese:"音"},
      {english:"quiet", japanese:"静か"},
      {english:"library", japanese:"図書館"},
      {english:"noise", japanese:"騒音"},
      {english:"friend", japanese:"友達"},
      {english:"talk", japanese:"話す"},
      {english:"rule", japanese:"ルール"},
      {english:"break", japanese:"破る"},
      {english:"ask", japanese:"尋ねる"},
      {english:"answer", japanese:"答え"},
      {english:"please", japanese:"お願いします"},
      {english:"thank you", japanese:"ありがとう"},
      {english:"respect", japanese:"尊敬"},
      {english:"help", japanese:"助ける"},
      {english:"clean", japanese:"きれいにする"}
    ],
    11: [
      {english:"want", japanese:"欲しい"},
      {english:"go", japanese:"行く"},
      {english:"eat", japanese:"食べる"},
      {english:"drink", japanese:"飲む"},
      {english:"play", japanese:"遊ぶ"},
      {english:"read", japanese:"読む"},
      {english:"write", japanese:"書く"},
      {english:"study", japanese:"勉強する"},
      {english:"sleep", japanese:"寝る"},
      {english:"walk", japanese:"歩く"},
      {english:"run", japanese:"走る"},
      {english:"watch", japanese:"見る"},
      {english:"listen", japanese:"聞く"},
      {english:"talk", japanese:"話す"},
      {english:"work", japanese:"働く"}
    ],
    12: [
      {english:"environment", japanese:"環境"},
      {english:"plastic", japanese:"プラスチック"},
      {english:"recycle", japanese:"リサイクル"},
      {english:"save", japanese:"救う"},
      {english:"pollution", japanese:"汚染"},
      {english:"nature", japanese:"自然"},
      {english:"earth", japanese:"地球"},
      {english:"animal", japanese:"動物"},
      {english:"forest", japanese:"森"},
      {english:"water", japanese:"水"},
      {english:"air", japanese:"空気"},
      {english:"reduce", japanese:"減らす"},
      {english:"reuse", japanese:"再利用"},
      {english:"clean", japanese:"きれい"},
      {english:"protect", japanese:"守る"}
    ],
    13: [
      {english:"must", japanese:"しなければならない"},
      {english:"cannot", japanese:"してはいけない"},
      {english:"should", japanese:"したほうがいい"},
      {english:"don't have to", japanese:"しなくてもいい"},
      {english:"always", japanese:"いつも"},
      {english:"never", japanese:"決して〜ない"},
      {english:"sometimes", japanese:"時々"},
      {english:"usually", japanese:"たいてい"},
      {english:"often", japanese:"よく"},
      {english:"rarely", japanese:"めったに〜ない"},
      {english:"maybe", japanese:"たぶん"},
      {english:"probably", japanese:"おそらく"},
      {english:"mustn't", japanese:"してはいけない"},
      {english:"could", japanese:"〜できた"},
      {english:"would", japanese:"〜だろう"}
    ],
    14: [
      {english:"want to", japanese:"〜したい"},
      {english:"like to", japanese:"〜するのが好き"},
      {english:"need to", japanese:"〜しなければならない"},
      {english:"try to", japanese:"〜しようとする"},
      {english:"plan to", japanese:"〜するつもり"},
      {english:"hope to", japanese:"〜することを望む"},
      {english:"decide to", japanese:"〜することに決める"},
      {english:"learn to", japanese:"〜することを学ぶ"},
      {english:"forget to", japanese:"〜することを忘れる"},
      {english:"remember to", japanese:"〜することを覚えている"}
    ],
    15: [
      {english:"use plastic", japanese:"プラスチックを使う"},
      {english:"save energy", japanese:"エネルギーを節約する"},
      {english:"recycle paper", japanese:"紙をリサイクルする"},
      {english:"turn off lights", japanese:"電気を消す"},
      {english:"plant trees", japanese:"木を植える"},
      {english:"walk to school", japanese:"学校に歩いて行く"},
      {english:"reduce waste", japanese:"ゴミを減らす"},
      {english:"use reusable bags", japanese:"再利用可能なバッグを使う"},
      {english:"avoid plastic bottles", japanese:"プラスチックのボトルを避ける"},
      {english:"save water", japanese:"水を節約する"}
    ]
  };

  const startScreen = document.getElementById('start-screen');
  const gameScreen = document.getElementById('game-screen');
  const playerNameInput = document.getElementById('player-name');
  const setButtonsDiv = document.getElementById('set-buttons');
  const japaneseList = document.getElementById('japanese-list');
  const englishList = document.getElementById('english-list');
  const timerDisplay = document.getElementById('timer');
  const progressBar = document.getElementById('progress-bar');
  const moneyAmount = document.getElementById('money-amount');
  const piggyBank = document.getElementById('piggy-bank');
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  let darkMode = false;

  let currentSet = null;
  let totalTime = 300; // 5 minutes in seconds
  let timeLeft = totalTime;
  let timerInterval = null;
  let money = 0;

  // To track correct matches: { english: japanese }
  let matchedPairs = new Map();

  // Setup dark mode toggle
  darkModeToggle.addEventListener('click', () => {
    darkMode = !darkMode;
    document.body.classList.toggle('dark-mode', darkMode);
    startScreen.classList.toggle('dark-mode', darkMode);
    gameScreen.classList.toggle('dark-mode', darkMode);
  });

  // Initialize start screen with set buttons
  function initStartScreen() {
    setButtonsDiv.innerHTML = '';
    for (const key in vocabSets) {
      const btn = document.createElement('button');
      btn.textContent = `Set ${key}`;
      btn.dataset.set = key;
      btn.addEventListener('click', () => {
        const name = playerNameInput.value.trim();
        if (!name) {
          alert('Please enter your name before starting!');
          playerNameInput.focus();
          return;
        }
        startGame(parseInt(btn.dataset.set));
      });
      setButtonsDiv.appendChild(btn);
    }
  }

  // Shuffle array
  function shuffle(arr) {
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // Start the game
  function startGame(setNumber) {
    currentSet = vocabSets[setNumber];
    timeLeft = totalTime;
    money = 0;
    matchedPairs.clear();

    startScreen.classList.add('hidden');
    gameScreen.classList.remove('hidden');

    updateMoney();
    setupWords();
    startTimer();
  }

  // Setup draggable Japanese words and English drop zones
  function setupWords() {
    japaneseList.innerHTML = '<h3>Japanese Words</h3>';
    englishList.innerHTML = '<h3>English Words</h3>';

    // Clone and shuffle
    const japWords = currentSet.map(e => e.japanese);
    const engWords = currentSet.map(e => e.english);
    shuffle(japWords);
    shuffle(engWords);

    // Create Japanese draggable words
    japWords.forEach(jp => {
      const div = document.createElement('div');
      div.textContent = jp;
      div.className = 'vocab-word';
      div.draggable = true;
      div.id = 'jp-' + jp;
      div.addEventListener('dragstart', dragStart);
      div.addEventListener('dragend', dragEnd);
      japaneseList.appendChild(div);
    });

    // Create English drop zones
    engWords.forEach(en => {
      const div = document.createElement('div');
      div.textContent = en;
      div.className = 'target-word';
      div.dataset.english = en;
      div.addEventListener('dragover', dragOver);
      div.addEventListener('drop', drop);
      englishList.appendChild(div);
    });
  }

  // Drag handlers
  function dragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.textContent);
    this.classList.add('dragging');
  }
  function dragEnd(e) {
    this.classList.remove('dragging');
  }
  function dragOver(e) {
    e.preventDefault();
  }
  function drop(e) {
    e.preventDefault();
    if (this.classList.contains('correct')) return; // already matched

    const draggedJapanese = e.dataTransfer.getData('text/plain');
    const english = this.dataset.english;

    // Find the correct Japanese for this English
    const correctPair = currentSet.find(pair => pair.english === english);
    if (!correctPair) return;

    if (correctPair.japanese === draggedJapanese) {
      // Correct match
      matchedPairs.set(english, draggedJapanese);
      this.classList.add('correct');
      this.textContent = english + " ✅";

      // Remove draggable Japanese word
      const jpElem = document.getElementById('jp-' + draggedJapanese);
      if (jpElem) jpElem.remove();

      addMoney(10);
      confetti();

      // Check if all matched
      if (matchedPairs.size === currentSet.length) {
        endGame(true);
      }
    } else {
      // Incorrect match
      this.classList.add('incorrect');
      this.classList.add('shake');
      setTimeout(() => {
        this.classList.remove('incorrect');
        this.classList.remove('shake');
      }, 600);
      // Optional: flash red on dragged word
      const jpElem = document.getElementById('jp-' + draggedJapanese);
      if (jpElem) {
        jpElem.classList.add('flash-red');
        setTimeout(() => {
          jpElem.classList.remove('flash-red');
        }, 800);
      }
    }
  }

  // Money update and coin animation
  function addMoney(amount) {
    money += amount;
    updateMoney();
    dropCoin();
  }
  function updateMoney() {
    moneyAmount.textContent = '¥' + money;
  }

  // Coin falling animation into piggy bank slot
  function dropCoin() {
    const coin = document.createElement('div');
    coin.className = 'coin';
    document.body.appendChild(coin);

    // Start at center of Japanese list (random Japanese word location)
    const japWords = document.querySelectorAll('.vocab-word');
    let startRect;
    if (japWords.length) {
      startRect = japWords[0].getBoundingClientRect();
    } else {
      startRect = japaneseList.getBoundingClientRect();
    }
    coin.style.left = startRect.left + startRect.width / 2 + 'px';
    coin.style.top = startRect.top + startRect.height / 2 + 'px';

    // Animate falling to piggy bank
    const pigRect = piggyBank.getBoundingClientRect();
    const dx = pigRect.left + pigRect.width / 2 - (startRect.left + startRect.width / 2);
    const dy = pigRect.top + pigRect.height / 2 - (startRect.top + startRect.height / 2);

    // Use CSS animation + JS to move coin
    coin.animate([
      { transform: 'translate(0, 0) scale(1)', opacity: 1 },
      { transform: `translate(${dx}px, ${dy}px) scale(0.3)`, opacity: 0 }
    ], { duration: 1000, easing: 'ease-in-out' });

    setTimeout(() => coin.remove(), 1100);
  }

  // Timer functions
  function startTimer() {
    updateTimerDisplay();
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimerDisplay();
      updateProgressBar();

      if (timeLeft <= 30) {
        timerDisplay.classList.add('pulse');
      } else {
        timerDisplay.classList.remove('pulse');
      }

      if (timeLeft <= 0) {
        endGame(false);
      }
    }, 1000);
  }
  function updateTimerDisplay() {
    const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
    const s = (timeLeft % 60).toString().padStart(2, '0');
    timerDisplay.textContent = `Time: ${m}:${s}`;
  }
  function updateProgressBar() {
    const percent = (timeLeft / totalTime) * 100;
    progressBar.style.width = percent + '%';
  }

  // End game
  function endGame(won) {
    clearInterval(timerInterval);
    if (won) {
      alert(`Congratulations! You matched all words and earned ¥${money}.`);
    } else {
      alert(`Time's up! You earned ¥${money}.`);
    }
    resetGame();
  }

  // Reset game to start screen
  function resetGame() {
    matchedPairs.clear();
    japaneseList.innerHTML = '';
    englishList.innerHTML = '';
    gameScreen.classList.add('hidden');
    startScreen.classList.remove('hidden');
    money = 0;
    updateMoney();
    timeLeft = totalTime;
    updateTimerDisplay();
    updateProgressBar();
  }

  // Confetti on correct match
  function confetti() {
    confettiLib({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  }
  // Wrap confetti to avoid name conflict with variable name
  function confettiLib(opts) {
    confetti(opts);
  }

  // Initialize
  initStartScreen();

</script>
</body>
</html>
