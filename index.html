<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Drag & Drop Vocabulary Match Game</title>

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Nico+Moji&display=swap" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Comic Neue', cursive;
    background: #f0f0f0;
    margin: 0; padding: 1rem;
    color: #333;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode {
    background-color: #121212;
    color: #ddd;
  }
  h1 {
    text-align: center;
    color: #00695c;
  }
  #dark-mode-toggle {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #00796b;
    color: white;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 18px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s;
    user-select: none;
  }
  #dark-mode-toggle:hover {
    background-color: #004d40;
  }
  .hidden {
    display: none;
  }

  /* Start screen */
  #start-screen {
    max-width: 600px;
    margin: 0 auto 2rem;
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  }
  #start-screen.dark-mode {
    background: #1f1f1f;
    box-shadow: 0 2px 12px rgba(0,0,0,0.9);
  }
  #player-name {
    width: 80%;
    font-size: 1rem;
    padding: 0.5rem;
    border-radius: 8px;
    border: 1px solid #aaa;
    font-family: 'Comic Neue', cursive;
    outline: none;
    margin-bottom: 1rem;
    transition: border-color 0.3s;
  }
  #player-name:focus {
    border-color: #00796b;
  }
  .set-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.7rem;
    justify-content: center;
  }
  .set-buttons button {
    padding: 0.6rem 1.2rem;
    background: #00796b;
    color: white;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-family: 'Comic Neue', cursive;
    transition: background-color 0.3s, transform 0.2s;
  }
  .set-buttons button:hover {
    background-color: #004d40;
    transform: scale(1.05);
  }

  /* Game screen */
  #game-screen {
    max-width: 700px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    user-select: none;
  }
  #game-screen.dark-mode {
    background: #1f1f1f;
    box-shadow: 0 2px 12px rgba(0,0,0,0.9);
  }

  #progress-container {
    width: 80%;
    height: 20px;
    background: #ddd;
    border-radius: 10px;
    margin: 0 auto 0.5rem auto;
    overflow: hidden;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
  }
  body.dark-mode #progress-container {
    background: #333;
    box-shadow: inset 0 0 5px rgba(255,255,255,0.1);
  }
  #progress-bar {
    height: 100%;
    width: 100%;
    background-color: #00796b;
    transition: width 1s linear;
  }
  body.dark-mode #progress-bar {
    background-color: #4caf50;
  }

  #timer {
    font-family: 'Nico Moji', monospace;
    font-weight: bold;
    font-size: 1.3rem;
    text-align: center;
    margin-bottom: 1rem;
    color: #004d40;
    transition: color 0.3s;
  }
  body.dark-mode #timer {
    color: #a5d6a7;
  }
  #timer.pulse {
    animation: pulseRed 1s infinite alternate;
    color: #e53935 !important;
  }
  @keyframes pulseRed {
    0% { color: #004d40; }
    100% { color: #e53935; }
  }

  #score-container {
    font-weight: bold;
    font-size: 1.4rem;
    color: #2e7d32;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 1rem;
  }
  body.dark-mode #score-container {
    color: #a5d6a7;
  }
  #money-amount {
    font-size: 1.6rem;
    color: #f9a825;
  }
  #piggy-bank {
    width: 60px;
    height: 50px;
    transition: transform 0.3s ease;
  }

  #word-lists {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 2rem;
    margin-top: 1rem;
  }

  /* Drop zones for English words */
  .drop-zone {
    flex: 1 1 45%;
    min-height: 320px;
    background: #a2cfc4;
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    overflow-y: auto;
  }
  body.dark-mode .drop-zone {
    background: #225544;
    box-shadow: 0 0 8px rgba(255,255,255,0.1);
  }

  .drop-zone h3 {
    margin: 0 0 10px 0;
    font-family: 'Comic Neue', cursive;
  }

  /* Draggable vocab words (Japanese) */
  .vocab-word {
    background: #d0e8e4;
    padding: 8px 12px;
    margin: 6px 0;
    border-radius: 10px;
    cursor: grab;
    user-select: none;
    font-family: 'Nico Moji', monospace;
    font-size: 1.2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    transition: background-color 0.3s;
  }
  .vocab-word.dragging {
    opacity: 0.5;
  }
  body.dark-mode .vocab-word {
    background: #336655;
    box-shadow: 0 2px 4px rgba(0,0,0,0.6);
  }

  /* English word targets */
  .target-word {
    background: #f4f4f4;
    padding: 10px 14px;
    margin: 8px 0;
    border-radius: 12px;
    border: 2px dashed #00796b;
    min-height: 42px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Comic Neue', cursive;
    transition: background-color 0.3s, border-color 0.3s;
    user-select: none;
  }
  .target-word.correct {
    background-color: #a5d6a7;
    border-color: #2e7d32;
    color: #2e7d32;
  }
  .target-word.incorrect {
    animation: shake 0.5s;
    border-color: #e53935;
  }
  body.dark-mode .target-word {
    background: #224433;
    border-color: #4caf50;
    color: #a5d6a7;
  }
  body.dark-mode .target-word.correct {
    background-color: #4caf50;
    border-color: #2e7d32;
    color: #1b3d1a;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-8px); }
    40%, 80% { transform: translateX(8px); }
  }

  /* Coin animation */
  .coin {
    position: fixed;
    width: 25px;
    height: 25px;
    background: radial-gradient(circle at 12px 12px, #ffd700 0%, #b8860b 100%);
    border-radius: 50%;
    box-shadow: inset 0 0 8px #fff700;
    pointer-events: none;
    animation: fallCoin 1s ease forwards;
    z-index: 1000;
  }
  @keyframes fallCoin {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateY(180px) scale(0.3); opacity: 0; }
  }
</style>
</head>
<body>

<div id="dark-mode-toggle" title="Toggle Dark Mode">ðŸŒ™</div>

<div id="start-screen" aria-label="Start screen">
  <h1>Vocabulary Match Game</h1>
  <input type="text" id="player-name" placeholder="Enter your name..." autocomplete="off" aria-label="Player name" />
  <div class="set-buttons" id="set-buttons" aria-label="Select vocabulary set"></div>
</div>

<div id="game-screen" class="hidden" aria-live="polite" aria-label="Game screen">
  <div id="progress-container" aria-label="Time progress">
    <div id="progress-bar"></div>
  </div>
  <div id="timer">Time: 05:00</div>
  <div id="score-container" aria-live="polite">
    Money: <span id="money-amount">Â¥0</span>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Piggy_bank_icon.svg/64px-Piggy_bank_icon.svg.png" id="piggy-bank" alt="Piggy bank" />
  </div>
  <div id="word-lists">
    <div class="drop-zone" id="japanese-list" aria-label="Japanese words (draggable)">
      <h3>Japanese Words</h3>
    </div>
    <div class="drop-zone" id="english-list" aria-label="English words (drop targets)">
      <h3>English Words</h3>
    </div>
  </div>
</div>

<script>
  const vocabSets = {
    1: [
      {english:"minute", japanese:"åˆ†"},
      {english:"before", japanese:"ã®å‰ã«"},
      {english:"photography", japanese:"å†™çœŸæ’®å½±"},
      {english:"tournament", japanese:"ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ"},
      {english:"against", japanese:"ã«å¯¾æŠ—ã—ã¦"},
      {english:"lost", japanese:"è² ã‘ã£ãŸ"},
      {english:"lose", japanese:"è² ã‘ã‚‹"},
      {english:"final", japanese:"æœ€å¾Œã®"},
      {english:"second", japanese:"ç§’"},
      {english:"broke", japanese:"å£Šã—ãŸ"},
      {english:"surely", japanese:"ç¢ºã‹ã«"},
      {english:"until", japanese:"ã€‚ã€‚ã€‚ã¾ã§"},
      {english:"half", japanese:"åŠåˆ†ã®"},
      {english:"hour", japanese:"ï¼‘æ™‚é–“"},
      {english:"tomorrow", japanese:"æ˜Žæ—¥"},
      {english:"today", japanese:"ä»Šæ—¥"},
      {english:"yesterday", japanese:"æ˜¨æ—¥"},
      {english:"ago", japanese:"ï½žå‰ã«"},
      {english:"spread", japanese:"åºƒã‚ã‚‹"}
    ],
    2: [
      {english:"if", japanese:"ã‚‚ã—"},
      {english:"plastic", japanese:"ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯"},
      {english:"exam", japanese:"ãƒ†ã‚¹ãƒˆ"},
      {english:"adventure", japanese:"å†’é™º"},
      {english:"read", japanese:"èª­ã‚€"},
      {english:"main", japanese:"ä¸»ãª"},
      {english:"naughty", japanese:"ã„ãŸãšã‚‰ãª"},
      {english:"trouble", japanese:"å¿ƒé…ã€æ‚©ã¿ã€ã‚„ã£ã‹ã„ãªäº‹æ…‹"},
      {english:"lend", japanese:"è²¸ã™"},
      {english:"another", japanese:"ã‚‚ã†ä¸€ã¤ã®"}
    ],
    3: [
      {english:"think", japanese:"è€ƒãˆã‚‹ãƒ»æ€ã†"},
      {english:"author", japanese:"ä½œè€…"},
      {english:"drew", japanese:"æã„ãŸ"},
      {english:"scenery", japanese:"æ™¯è‰²"},
      {english:"in fact", japanese:"ä»Šã¾ã§"},
      {english:"area", japanese:"åœ°åŸŸ"},
      {english:"still", japanese:"ã¾ã "},
      {english:"hope", japanese:"æœ›ã‚€"},
      {english:"someday", japanese:"ã„ã¤ã‹"},
      {english:"how", japanese:"ã©ã†"},
      {english:"borrow", japanese:"å€Ÿã‚Šã‚‹"},
      {english:"fantasy", japanese:"ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼"},
      {english:"message", japanese:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"},
      {english:"horror", japanese:"ãƒ›ãƒ©ãƒ¼"},
      {english:"novel", japanese:"å°èª¬"},
      {english:"mystery", japanese:"ãƒŸã‚¹ãƒ†ãƒªãƒ¼"},
      {english:"encourage", japanese:"åŠ±ã¾ã™"}
    ],
    4: [
      {english:"finish", japanese:"çµ‚ã‚ã‚‹"},
      {english:"training", japanese:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°"},
      {english:"perfect", japanese:"å®Œç’§"},
      {english:"learner", japanese:"å­¦ç¿’è€…"},
      {english:"because", japanese:"ã ã‹ã‚‰ãƒ»ãªã®ã§"},
      {english:"easy", japanese:"å„ªã—ã„ãƒ»ç°¡å˜ãª"},
      {english:"plus", japanese:"ã•ã‚‰ã«ãã®ä¸Š"},
      {english:"teenager", japanese:"ï¼‘ï¼ä»£ã®å°‘å¹´"},
      {english:"among", japanese:"ã®ä¸­ã«ãƒ»ã®é–“ã«"},
      {english:"ending", japanese:"çµ‚ã‚ã‚Š"},
      {english:"town", japanese:"ç”º"},
      {english:"witch", japanese:"é­”å¥³"}
    ],
    5: [
      {english:"famous", japanese:"æœ‰å"},
      {english:"dream", japanese:"å¤¢"},
      {english:"build", japanese:"å»ºã¦ã‚‹"},
      {english:"tower", japanese:"å¡”"},
      {english:"around the world", japanese:"ä¸–ç•Œä¸­"},
      {english:"world", japanese:"ä¸–ç•Œ"},
      {english:"decide", japanese:"æ±ºã‚ã‚‹"},
      {english:"interest", japanese:"èˆˆå‘³"},
      {english:"yourself", japanese:"ã‚ãªãŸè‡ªèº«"},
      {english:"lots of", japanese:"ãŸãã•ã‚“ã®"},
      {english:"bake", japanese:"ç„¼ã"},
      {english:"more", japanese:"ã‚‚ã£ã¨"},
      {english:"perhaps", japanese:"å¤šåˆ†"},
      {english:"bakery", japanese:"ãƒ‘ãƒ³å±‹"},
      {english:"need", japanese:"å¿…è¦"}
    ],
    6: [
      {english:"relax", japanese:"ãã¤ã‚ã"},
      {english:"customer", japanese:"ãŠå®¢ã•ã‚“"},
      {english:"provide", japanese:"æä¾›ã™ã‚‹"},
      {english:"several", japanese:"ã„ãã¤ã‹ã®"},
      {english:"that way", japanese:"ãã®ã‚ˆã†ã«ã—ã¦"},
      {english:"plenty", japanese:"ååˆ†ãª"},
      {english:"choice", japanese:"é¸æŠž"},
      {english:"however", japanese:"ã—ã‹ã—ãªãŒã‚‰"},
      {english:"leftovers", japanese:"æ®‹ã‚Šç‰©ãƒ»é£Ÿã¹æ®‹ã—"},
      {english:"away", japanese:"åˆ¥ã®æ–¹å‘ã¸ãƒ»ã‚ãã¸"},
      {english:"throw away", japanese:"ç„¡é§„ã«ä½¿ã†"},
      {english:"waste", japanese:"ç„¡é§„"},
      {english:"discount", japanese:"å‰²å¼•"},
      {english:"enough", japanese:"ååˆ†ãª"},
      {english:"help", japanese:"åŠ©ã‘ã‚‹"}
    ],
    7: [
      {english:"pool", japanese:"ãƒ—ãƒ¼ãƒ«"},
      {english:"over", japanese:"ã€œä»¥ä¸Š"},
      {english:"review", japanese:"è¦‹ç›´ã™"},
      {english:"rule", japanese:"è¦å‰‡"},
      {english:"kitchen", japanese:"å°æ‰€"},
      {english:"must", japanese:"ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"mask", japanese:"ãƒžã‚¹ã‚¯"},
      {english:"smartphone", japanese:"ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³"},
      {english:"back", japanese:"æˆ»ã‚‹"},
      {english:"return", japanese:"è¿”ã™"},
      {english:"week", japanese:"é€±"},
      {english:"quiet", japanese:"é™ã‹ãª"},
      {english:"future", japanese:"æœªæ¥"},
      {english:"in the future", japanese:"å°†æ¥"},
      {english:"somewhere", japanese:"ã©ã“ã‹ã«"},
      {english:"explore", japanese:"æŽ¢æ¤œã™ã‚‹"},
      {english:"clothes", japanese:"æœ"},
      {english:"design", japanese:"ãƒ‡ã‚¶ã‚¤ãƒ³"},
      {english:"chef", japanese:"ã‚·ã‚§ãƒ•"}
    ],
    8: [
      {english:"as", japanese:"ã€œã¨ã—ã¦"},
      {english:"behind", japanese:"å¾Œã‚ã«"},
      {english:"cut down", japanese:"åˆ‡ã‚Šå€’ã™"},
      {english:"building", japanese:"å»ºç‰©"},
      {english:"destroy", japanese:"ç ´å£Šã™ã‚‹"},
      {english:"shock", japanese:"ã‚·ãƒ§ãƒƒã‚¯"},
      {english:"great", japanese:"ç´ æ™´ã‚‰ã—ã„"},
      {english:"like", japanese:"ã€œã®ã‚ˆã†ãª"},
      {english:"think", japanese:"è€ƒãˆã‚‹"},
      {english:"rainforest", japanese:"ç†±å¸¯é›¨æž—"},
      {english:"cutting", japanese:"åˆ‡ã‚‹ã“ã¨"},
      {english:"tree", japanese:"æœ¨"},
      {english:"really", japanese:"æœ¬å½“ã«"},
      {english:"clean", japanese:"ãã‚Œã„ãª"},
      {english:"save", japanese:"æ•‘ã†ãƒ»ä¿å­˜ã™ã‚‹"},
      {english:"too much", japanese:"å¤šã™ãŽã‚‹"},
      {english:"need to", japanese:"ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"but", japanese:"ã—ã‹ã—"},
      {english:"cause", japanese:"åŽŸå› ã«ãªã‚‹"},
      {english:"problem", japanese:"å•é¡Œ"}
    ],
    9: [
      {english:"bring", japanese:"æŒã£ã¦ãã‚‹"},
      {english:"wait", japanese:"å¾…ã¤"},
      {english:"tired", japanese:"ç–²ã‚ŒãŸ"},
      {english:"bus stop", japanese:"ãƒã‚¹åœ"},
      {english:"miss", japanese:"ä¹—ã‚Šé…ã‚Œã‚‹"},
      {english:"catch", japanese:"é–“ã«åˆã†ãƒ»æ•ã¾ãˆã‚‹"},
      {english:"morning", japanese:"æœ"},
      {english:"first", japanese:"æœ€åˆã®"},
      {english:"train", japanese:"é›»è»Š"},
      {english:"hope", japanese:"æœ›ã‚€"},
      {english:"have to", japanese:"ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"forget", japanese:"å¿˜ã‚Œã‚‹"},
      {english:"key", japanese:"éµ"},
      {english:"door", japanese:"ãƒ‰ã‚¢"},
      {english:"close", japanese:"é–‰ã‚ã‚‹"},
      {english:"bus", japanese:"ãƒã‚¹"},
      {english:"stop", japanese:"æ­¢ã¾ã‚‹"},
      {english:"late", japanese:"é…ã„"}
    ],
    10: [
      {english:"listen", japanese:"èžã"},
      {english:"sound", japanese:"éŸ³"},
      {english:"quiet", japanese:"é™ã‹"},
      {english:"library", japanese:"å›³æ›¸é¤¨"},
      {english:"noise", japanese:"é¨’éŸ³"},
      {english:"friend", japanese:"å‹é”"},
      {english:"talk", japanese:"è©±ã™"},
      {english:"rule", japanese:"ãƒ«ãƒ¼ãƒ«"},
      {english:"break", japanese:"ç ´ã‚‹"},
      {english:"ask", japanese:"å°‹ã­ã‚‹"},
      {english:"answer", japanese:"ç­”ãˆ"},
      {english:"please", japanese:"ãŠé¡˜ã„ã—ã¾ã™"},
      {english:"thank you", japanese:"ã‚ã‚ŠãŒã¨ã†"},
      {english:"respect", japanese:"å°Šæ•¬"},
      {english:"help", japanese:"åŠ©ã‘ã‚‹"},
      {english:"clean", japanese:"ãã‚Œã„ã«ã™ã‚‹"}
    ],
    11: [
      {english:"want", japanese:"æ¬²ã—ã„"},
      {english:"go", japanese:"è¡Œã"},
      {english:"eat", japanese:"é£Ÿã¹ã‚‹"},
      {english:"drink", japanese:"é£²ã‚€"},
      {english:"play", japanese:"éŠã¶"},
      {english:"read", japanese:"èª­ã‚€"},
      {english:"write", japanese:"æ›¸ã"},
      {english:"study", japanese:"å‹‰å¼·ã™ã‚‹"},
      {english:"sleep", japanese:"å¯ã‚‹"},
      {english:"walk", japanese:"æ­©ã"},
      {english:"run", japanese:"èµ°ã‚‹"},
      {english:"watch", japanese:"è¦‹ã‚‹"},
      {english:"listen", japanese:"èžã"},
      {english:"talk", japanese:"è©±ã™"},
      {english:"work", japanese:"åƒã"}
    ],
    12: [
      {english:"environment", japanese:"ç’°å¢ƒ"},
      {english:"plastic", japanese:"ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯"},
      {english:"recycle", japanese:"ãƒªã‚µã‚¤ã‚¯ãƒ«"},
      {english:"save", japanese:"æ•‘ã†"},
      {english:"pollution", japanese:"æ±šæŸ“"},
      {english:"nature", japanese:"è‡ªç„¶"},
      {english:"earth", japanese:"åœ°çƒ"},
      {english:"animal", japanese:"å‹•ç‰©"},
      {english:"forest", japanese:"æ£®"},
      {english:"water", japanese:"æ°´"},
      {english:"air", japanese:"ç©ºæ°—"},
      {english:"reduce", japanese:"æ¸›ã‚‰ã™"},
      {english:"reuse", japanese:"å†åˆ©ç”¨"},
      {english:"clean", japanese:"ãã‚Œã„"},
      {english:"protect", japanese:"å®ˆã‚‹"}
    ],
    13: [
      {english:"must", japanese:"ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"cannot", japanese:"ã—ã¦ã¯ã„ã‘ãªã„"},
      {english:"should", japanese:"ã—ãŸã»ã†ãŒã„ã„"},
      {english:"don't have to", japanese:"ã—ãªãã¦ã‚‚ã„ã„"},
      {english:"always", japanese:"ã„ã¤ã‚‚"},
      {english:"never", japanese:"æ±ºã—ã¦ã€œãªã„"},
      {english:"sometimes", japanese:"æ™‚ã€…"},
      {english:"usually", japanese:"ãŸã„ã¦ã„"},
      {english:"often", japanese:"ã‚ˆã"},
      {english:"rarely", japanese:"ã‚ã£ãŸã«ã€œãªã„"},
      {english:"maybe", japanese:"ãŸã¶ã‚“"},
      {english:"probably", japanese:"ãŠãã‚‰ã"},
      {english:"mustn't", japanese:"ã—ã¦ã¯ã„ã‘ãªã„"},
      {english:"could", japanese:"ã€œã§ããŸ"},
      {english:"would", japanese:"ã€œã ã‚ã†"}
    ],
    14: [
      {english:"want to", japanese:"ã€œã—ãŸã„"},
      {english:"like to", japanese:"ã€œã™ã‚‹ã®ãŒå¥½ã"},
      {english:"need to", japanese:"ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"try to", japanese:"ã€œã—ã‚ˆã†ã¨ã™ã‚‹"},
      {english:"plan to", japanese:"ã€œã™ã‚‹ã¤ã‚‚ã‚Š"},
      {english:"hope to", japanese:"ã€œã™ã‚‹ã“ã¨ã‚’æœ›ã‚€"},
      {english:"decide to", japanese:"ã€œã™ã‚‹ã“ã¨ã«æ±ºã‚ã‚‹"},
      {english:"learn to", japanese:"ã€œã™ã‚‹ã“ã¨ã‚’å­¦ã¶"},
      {english:"forget to", japanese:"ã€œã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œã‚‹"},
      {english:"remember to", japanese:"ã€œã™ã‚‹ã“ã¨ã‚’è¦šãˆã¦ã„ã‚‹"}
    ],
    15: [
      {english:"use plastic", japanese:"ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã‚’ä½¿ã†"},
      {english:"save energy", japanese:"ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ç¯€ç´„ã™ã‚‹"},
      {english:"recycle paper", japanese:"ç´™ã‚’ãƒªã‚µã‚¤ã‚¯ãƒ«ã™ã‚‹"},
      {english:"turn off lights", japanese:"é›»æ°—ã‚’æ¶ˆã™"},
      {english:"plant trees", japanese:"æœ¨ã‚’æ¤ãˆã‚‹"},
      {english:"walk to school", japanese:"å­¦æ ¡ã«æ­©ã„ã¦è¡Œã"},
      {english:"reduce waste", japanese:"ã‚´ãƒŸã‚’æ¸›ã‚‰ã™"},
      {english:"use reusable bags", japanese:"å†åˆ©ç”¨å¯èƒ½ãªãƒãƒƒã‚°ã‚’ä½¿ã†"},
      {english:"avoid plastic bottles", japanese:"ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã®ãƒœãƒˆãƒ«ã‚’é¿ã‘ã‚‹"},
      {english:"save water", japanese:"æ°´ã‚’ç¯€ç´„ã™ã‚‹"}
    ]
  };

  const startScreen = document.getElementById('start-screen');
  const gameScreen = document.getElementById('game-screen');
  const playerNameInput = document.getElementById('player-name');
  const setButtonsDiv = document.getElementById('set-buttons');
  const japaneseList = document.getElementById('japanese-list');
  const englishList = document.getElementById('english-list');
  const timerDisplay = document.getElementById('timer');
  const progressBar = document.getElementById('progress-bar');
  const moneyAmount = document.getElementById('money-amount');
  const piggyBank = document.getElementById('piggy-bank');
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  let darkMode = false;

  let currentSet = null;
  let totalTime = 300; // 5 minutes in seconds
  let timeLeft = totalTime;
  let timerInterval = null;
  let money = 0;

  // To track correct matches: { english: japanese }
  let matchedPairs = new Map();

  // Setup dark mode toggle
  darkModeToggle.addEventListener('click', () => {
    darkMode = !darkMode;
    document.body.classList.toggle('dark-mode', darkMode);
    startScreen.classList.toggle('dark-mode', darkMode);
    gameScreen.classList.toggle('dark-mode', darkMode);
  });

  // Initialize start screen with set buttons
  function initStartScreen() {
    setButtonsDiv.innerHTML = '';
    for (const key in vocabSets) {
      const btn = document.createElement('button');
      btn.textContent = `Set ${key}`;
      btn.dataset.set = key;
      btn.addEventListener('click', () => {
        const name = playerNameInput.value.trim();
        if (!name) {
          alert('Please enter your name before starting!');
          playerNameInput.focus();
          return;
        }
        startGame(parseInt(btn.dataset.set));
      });
      setButtonsDiv.appendChild(btn);
    }
  }

  // Shuffle array
  function shuffle(arr) {
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  // Start the game
  function startGame(setNumber) {
    currentSet = vocabSets[setNumber];
    timeLeft = totalTime;
    money = 0;
    matchedPairs.clear();

    startScreen.classList.add('hidden');
    gameScreen.classList.remove('hidden');

    updateMoney();
    setupWords();
    startTimer();
  }

  // Setup draggable Japanese words and English drop zones
  function setupWords() {
    japaneseList.innerHTML = '<h3>Japanese Words</h3>';
    englishList.innerHTML = '<h3>English Words</h3>';

    // Clone and shuffle
    const japWords = currentSet.map(e => e.japanese);
    const engWords = currentSet.map(e => e.english);
    shuffle(japWords);
    shuffle(engWords);

    // Create Japanese draggable words
    japWords.forEach(jp => {
      const div = document.createElement('div');
      div.textContent = jp;
      div.className = 'vocab-word';
      div.draggable = true;
      div.id = 'jp-' + jp;
      div.addEventListener('dragstart', dragStart);
      div.addEventListener('dragend', dragEnd);
      japaneseList.appendChild(div);
    });

    // Create English drop zones
    engWords.forEach(en => {
      const div = document.createElement('div');
      div.textContent = en;
      div.className = 'target-word';
      div.dataset.english = en;
      div.addEventListener('dragover', dragOver);
      div.addEventListener('drop', drop);
      englishList.appendChild(div);
    });
  }

  // Drag handlers
  function dragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.textContent);
    this.classList.add('dragging');
  }
  function dragEnd(e) {
    this.classList.remove('dragging');
  }
  function dragOver(e) {
    e.preventDefault();
  }
  function drop(e) {
    e.preventDefault();
    if (this.classList.contains('correct')) return; // already matched

    const draggedJapanese = e.dataTransfer.getData('text/plain');
    const english = this.dataset.english;

    // Find the correct Japanese for this English
    const correctPair = currentSet.find(pair => pair.english === english);
    if (!correctPair) return;

    if (correctPair.japanese === draggedJapanese) {
      // Correct match
      matchedPairs.set(english, draggedJapanese);
      this.classList.add('correct');
      this.textContent = english + " âœ…";

      // Remove draggable Japanese word
      const jpElem = document.getElementById('jp-' + draggedJapanese);
      if (jpElem) jpElem.remove();

      addMoney(10);
      confetti();

      // Check if all matched
      if (matchedPairs.size === currentSet.length) {
        endGame(true);
      }
    } else {
      // Incorrect match
      this.classList.add('incorrect');
      this.classList.add('shake');
      setTimeout(() => {
        this.classList.remove('incorrect');
        this.classList.remove('shake');
      }, 600);
      // Optional: flash red on dragged word
      const jpElem = document.getElementById('jp-' + draggedJapanese);
      if (jpElem) {
        jpElem.classList.add('flash-red');
        setTimeout(() => {
          jpElem.classList.remove('flash-red');
        }, 800);
      }
    }
  }

  // Money update and coin animation
  function addMoney(amount) {
    money += amount;
    updateMoney();
    dropCoin();
  }
  function updateMoney() {
    moneyAmount.textContent = 'Â¥' + money;
  }

  // Coin falling animation into piggy bank slot
  function dropCoin() {
    const coin = document.createElement('div');
    coin.className = 'coin';
    document.body.appendChild(coin);

    // Start at center of Japanese list (random Japanese word location)
    const japWords = document.querySelectorAll('.vocab-word');
    let startRect;
    if (japWords.length) {
      startRect = japWords[0].getBoundingClientRect();
    } else {
      startRect = japaneseList.getBoundingClientRect();
    }
    coin.style.left = startRect.left + startRect.width / 2 + 'px';
    coin.style.top = startRect.top + startRect.height / 2 + 'px';

    // Animate falling to piggy bank
    const pigRect = piggyBank.getBoundingClientRect();
    const dx = pigRect.left + pigRect.width / 2 - (startRect.left + startRect.width / 2);
    const dy = pigRect.top + pigRect.height / 2 - (startRect.top + startRect.height / 2);

    // Use CSS animation + JS to move coin
    coin.animate([
      { transform: 'translate(0, 0) scale(1)', opacity: 1 },
      { transform: `translate(${dx}px, ${dy}px) scale(0.3)`, opacity: 0 }
    ], { duration: 1000, easing: 'ease-in-out' });

    setTimeout(() => coin.remove(), 1100);
  }

  // Timer functions
  function startTimer() {
    updateTimerDisplay();
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimerDisplay();
      updateProgressBar();

      if (timeLeft <= 30) {
        timerDisplay.classList.add('pulse');
      } else {
        timerDisplay.classList.remove('pulse');
      }

      if (timeLeft <= 0) {
        endGame(false);
      }
    }, 1000);
  }
  function updateTimerDisplay() {
    const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
    const s = (timeLeft % 60).toString().padStart(2, '0');
    timerDisplay.textContent = `Time: ${m}:${s}`;
  }
  function updateProgressBar() {
    const percent = (timeLeft / totalTime) * 100;
    progressBar.style.width = percent + '%';
  }

  // End game
  function endGame(won) {
    clearInterval(timerInterval);
    if (won) {
      alert(`Congratulations! You matched all words and earned Â¥${money}.`);
    } else {
      alert(`Time's up! You earned Â¥${money}.`);
    }
    resetGame();
  }

  // Reset game to start screen
  function resetGame() {
    matchedPairs.clear();
    japaneseList.innerHTML = '';
    englishList.innerHTML = '';
    gameScreen.classList.add('hidden');
    startScreen.classList.remove('hidden');
    money = 0;
    updateMoney();
    timeLeft = totalTime;
    updateTimerDisplay();
    updateProgressBar();
  }

  // Confetti on correct match
  function confetti() {
    confettiLib({
      particleCount: 100,
      spread: 70,
      origin: { y: 0.6 }
    });
  }
  // Wrap confetti to avoid name conflict with variable name
  function confettiLib(opts) {
    confetti(opts);
  }

  // Initialize
  initStartScreen();

</script>
</body>
</html>
