<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vocabulary Match Game</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap" rel="stylesheet" />
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Comic Neue', cursive;
    margin: 0; padding: 0;
    background: #fefefe;
    color: #222;
    user-select: none;
    overflow-x: hidden;
  }
  h1.title {
    text-align: center;
    font-size: 2.8rem;
    margin: 24px 0;
    font-weight: 700;
    color: #d6336c;
  }
  #start-menu {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 16px;
  }
  #lesson-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    max-width: 720px;
  }
  #lesson-buttons button, #start-menu button {
    background-color: #ffe0f0;
    border: none;
    border-radius: 10px;
    padding: 12px 22px;
    font-size: 1.15rem;
    cursor: pointer;
    transition: background-color 0.25s, transform 0.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    min-width: 120px;
  }
  #lesson-buttons button:hover, #start-menu button:hover {
    background-color: #ffbad4;
    transform: scale(1.05);
  }
  #dark-mode-toggle {
    margin-top: 16px;
    background-color: #dcdcdc;
    color: #333;
  }
  #game-grid {
    max-width: 900px;
    margin: 0 auto 40px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    padding: 0 16px 24px;
  }
  .droppable {
    border: 2px dashed #ccc;
    background-color: #f7f7f7;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.15rem;
    border-radius: 8px;
    position: relative;
    user-select: none;
  }
  .droppable.matched {
    border-style: solid;
    border-color: #57d26f;
    background-color: #dbf7dc;
  }
  .draggable {
    background-color: #fff;
    border: 1.8px solid #ccc;
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 1.2rem;
    text-align: center;
    cursor: grab;
    user-select: none;
    position: relative;
    transition: box-shadow 0.2s, transform 0.2s;
  }
  .draggable:active {
    cursor: grabbing;
  }
  .draggable.matched {
    border-color: #57d26f;
    background-color: #dbf7dc;
    cursor: default;
  }
  .hide {
    visibility: hidden;
  }
  /* Red shake animation on wrong drop */
  @keyframes shake {
    0% { transform: translateX(0); border-color: #ccc;}
    20% { transform: translateX(-8px); border-color: #ff4c4c;}
    40% { transform: translateX(8px); border-color: #ff4c4c;}
    60% { transform: translateX(-8px); border-color: #ff4c4c;}
    80% { transform: translateX(8px); border-color: #ff4c4c;}
    100% { transform: translateX(0); border-color: #ccc;}
  }
  .shake {
    animation: shake 0.4s;
    border-color: #ff4c4c !important;
  }
  /* Confetti canvas */
  #confetti-canvas {
    pointer-events: none;
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: 9999;
  }
  /* Progress bar */
  #progress-container {
    max-width: 900px;
    margin: 0 auto 20px;
    background-color: #eee;
    border-radius: 12px;
    height: 20px;
    overflow: hidden;
  }
  #progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #d6336c 0%, #ff96b8 100%);
    width: 0%;
    transition: width 0.4s ease;
  }
  /* Streak counter */
  #streak-counter {
    text-align: center;
    font-size: 1.3rem;
    font-weight: 700;
    color: #d6336c;
    margin-bottom: 10px;
  }
  /* Dark mode */
  body.dark-mode {
    background: #1c1c1c;
    color: #ddd;
  }
  body.dark-mode #start-menu button,
  body.dark-mode #lesson-buttons button {
    background-color: #444;
    color: #eee;
  }
  body.dark-mode #start-menu button:hover,
  body.dark-mode #lesson-buttons button:hover {
    background-color: #666;
  }
  body.dark-mode #game-grid {
    background-color: #121212;
  }
  body.dark-mode .droppable {
    border-color: #555;
    background-color: #222;
    color: #eee;
  }
  body.dark-mode .droppable.matched {
    background-color: #2a4d2a;
    border-color: #57d26f;
  }
  body.dark-mode .draggable {
    background-color: #333;
    border-color: #555;
    color: #eee;
  }
  body.dark-mode .draggable.matched {
    background-color: #2a4d2a;
    border-color: #57d26f;
  }
  body.dark-mode #progress-container {
    background-color: #333;
  }
  /* Sparkle effect for correct */
  .sparkle {
    position: absolute;
    pointer-events: none;
    width: 40px;
    height: 40px;
    background: radial-gradient(circle, #fff, rgba(255,255,255,0));
    border-radius: 50%;
    animation: sparkleAnim 0.8s ease forwards;
    top: -15px;
    right: -15px;
  }
  @keyframes sparkleAnim {
    0% {
      opacity: 1;
      transform: scale(0.5) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: scale(2) rotate(360deg);
    }
  }
</style>
</head>
<body>

<div id="start-menu" class="active">
  <h1 class="title">Vocabulary Match Game</h1>
  <div id="lesson-buttons"></div>
  <button id="dark-mode-toggle" title="Toggle Dark Mode">ðŸŒ“ Toggle Dark Mode</button>
</div>

<div id="progress-container" style="display:none;">
  <div id="progress-bar"></div>
</div>

<div id="streak-counter" style="display:none;">Streak: 0 ðŸ”¥</div>

<div id="game-grid" style="display:none;"></div>

<canvas id="confetti-canvas"></canvas>

<script>
  const lessons = [
    {
      name: "Lesson 1",
       1: [
      {english:"minute", japanese:"åˆ†"},
      {english:"before", japanese:"ã®å‰ã«"},
      {english:"photography", japanese:"å†™çœŸæ’®å½±"},
      {english:"tournament", japanese:"ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ"},
      {english:"against", japanese:"ã«å¯¾æŠ—ã—ã¦"},
      {english:"lost", japanese:"è² ã‘ã£ãŸ"},
      {english:"lose", japanese:"è² ã‘ã‚‹"},
      {english:"final", japanese:"æœ€å¾Œã®"},
      {english:"second", japanese:"ç§’"},
      {english:"broke", japanese:"å£Šã—ãŸ"},
      {english:"surely", japanese:"ç¢ºã‹ã«"},
      {english:"until", japanese:"ã€‚ã€‚ã€‚ã¾ã§"},
      {english:"half", japanese:"åŠåˆ†ã®"},
      {english:"hour", japanese:"ï¼‘æ™‚é–“"},
      {english:"tomorrow", japanese:"æ˜Žæ—¥"},
      {english:"today", japanese:"ä»Šæ—¥"},
      {english:"yesterday", japanese:"æ˜¨æ—¥"},
      {english:"ago", japanese:"ï½žå‰ã«"},
      {english:"spread", japanese:"åºƒã‚ã‚‹"},
    ],
    2: [
      {english:"if", japanese:"ã‚‚ã—"},
      {english:"plastic", japanese:"ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯"},
      {english:"exam", japanese:"ãƒ†ã‚¹ãƒˆ"},
      {english:"adventure", japanese:"å†’é™º"},
      {english:"read", japanese:"èª­ã‚€"},
      {english:"main", japanese:"ä¸»ãª"},
      {english:"naughty", japanese:"ã„ãŸãšã‚‰ãª"},
      {english:"trouble", japanese:"å¿ƒé…ã€æ‚©ã¿ã€ã‚„ã£ã‹ã„ãªäº‹æ…‹"},
      {english:"lend", japanese:"è²¸ã™"},
      {english:"another", japanese:"ã‚‚ã†ä¸€ã¤ã®"},
    ],
    3: [
      {english:"think", japanese:"è€ƒãˆã‚‹ãƒ»æ€ã†"},
      {english:"author", japanese:"ä½œè€…"},
      {english:"drew", japanese:"æã„ãŸ"},
      {english:"scenery", japanese:"æ™¯è‰²"},
      {english:"in fact", japanese:"ä»Šã¾ã§"},
      {english:"area", japanese:"åœ°åŸŸ"},
      {english:"still", japanese:"ã¾ã "},
      {english:"hope", japanese:"æœ›ã‚€"},
      {english:"someday", japanese:"ã„ã¤ã‹"},
      {english:"how", japanese:"ã©ã†"},
      {english:"borrow", japanese:"å€Ÿã‚Šã‚‹"},
      {english:"fantasy", japanese:"ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼"},
      {english:"message", japanese:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"},
      {english:"horror", japanese:"ãƒ›ãƒ©ãƒ¼"},
      {english:"novel", japanese:"å°èª¬"},
      {english:"mystery", japanese:"ãƒŸã‚¹ãƒ†ãƒªãƒ¼"},
      {english:"encourage", japanese:"åŠ±ã¾ã™"},
    ],
    4: [
      {english:"finish", japanese:"çµ‚ã‚ã‚‹"},
      {english:"training", japanese:"ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°"},
      {english:"perfect", japanese:"å®Œç’§"},
      {english:"learner", japanese:"å­¦ç¿’è€…"},
      {english:"because", japanese:"ã ã‹ã‚‰ãƒ»ãªã®ã§"},
      {english:"easy", japanese:"å„ªã—ã„ãƒ»ç°¡å˜ãª"},
      {english:"plus", japanese:"ã•ã‚‰ã«ãã®ä¸Š"},
      {english:"teenager", japanese:"ï¼‘ï¼ä»£ã®å°‘å¹´"},
      {english:"among", japanese:"ã®ä¸­ã«ãƒ»ã®é–“ã«"},
      {english:"ending", japanese:"çµ‚ã‚ã‚Š"},
      {english:"town", japanese:"ç”º"},
      {english:"witch", japanese:"é­”å¥³"},
    ],
    5: [
      {english:"famous", japanese:"æœ‰å"},
      {english:"dream", japanese:"å¤¢"},
      {english:"build", japanese:"å»ºã¦ã‚‹"},
      {english:"tower", japanese:"å¡”"},
      {english:"around the world", japanese:"ä¸–ç•Œä¸­"},
      {english:"world", japanese:"ä¸–ç•Œ"},
      {english:"decide", japanese:"æ±ºã‚ã‚‹"},
      {english:"interest", japanese:"èˆˆå‘³"},
      {english:"yourself", japanese:"ã‚ãªãŸè‡ªèº«"},
      {english:"lots of", japanese:"ãŸãã•ã‚“ã®"},
      {english:"bake", japanese:"ç„¼ã"},
      {english:"more", japanese:"ã‚‚ã£ã¨"},
      {english:"perhaps", japanese:"å¤šåˆ†"},
      {english:"bakery", japanese:"ãƒ‘ãƒ³å±‹"},
      {english:"need", japanese:"å¿…è¦"},
    ],
    6: [
      {english:"relax", japanese:"ãã¤ã‚ã"},
      {english:"customer", japanese:"ãŠå®¢ã•ã‚“"},
      {english:"provide", japanese:"æä¾›ã™ã‚‹"},
      {english:"several", japanese:"ã„ãã¤ã‹ã®"},
      {english:"that way", japanese:"ãã®ã‚ˆã†ã«ã—ã¦"},
      {english:"plenty", japanese:"ååˆ†ãª"},
      {english:"choice", japanese:"é¸æŠž"},
      {english:"however", japanese:"ã—ã‹ã—ãªãŒã‚‰"},
      {english:"leftovers", japanese:"æ®‹ã‚Šç‰©ãƒ»é£Ÿã¹æ®‹ã—"},
      {english:"away", japanese:"åˆ¥ã®æ–¹å‘ã¸ãƒ»ã‚ãã¸"},
      {english:"throw away", japanese:"ç„¡é§„ã«ä½¿ã†"},
      {english:"waste", japanese:"ç„¡é§„"},
      {english:"discount", japanese:"å‰²å¼•"},
      {english:"enough", japanese:"ååˆ†ãª"},
      {english:"help", japanese:"åŠ©ã‘ã‚‹"},
    ],
    7: [
      {english:"pool", japanese:"ãƒ—ãƒ¼ãƒ«"},
      {english:"over", japanese:"ã€œä»¥ä¸Š"},
      {english:"review", japanese:"è¦‹ç›´ã™"},
      {english:"rule", japanese:"è¦å‰‡"},
      {english:"kitchen", japanese:"å°æ‰€"},
      {english:"must", japanese:"ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"mask", japanese:"ãƒžã‚¹ã‚¯"},
      {english:"smartphone", japanese:"ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³"},
      {english:"back", japanese:"æˆ»ã‚‹"},
      {english:"return", japanese:"è¿”ã™"},
      {english:"week", japanese:"é€±"},
      {english:"quiet", japanese:"é™ã‹ãª"},
      {english:"future", japanese:"æœªæ¥"},
      {english:"in the future", japanese:"å°†æ¥"},
      {english:"somewhere", japanese:"ã©ã“ã‹ã«"},
      {english:"explore", japanese:"æŽ¢æ¤œã™ã‚‹"},
      {english:"clothes", japanese:"æœ"},
      {english:"design", japanese:"ãƒ‡ã‚¶ã‚¤ãƒ³"},
      {english:"chef", japanese:"ã‚·ã‚§ãƒ•"},
    ],
    8: [
      {english:"as", japanese:"ã€œã¨ã—ã¦"},
      {english:"behind", japanese:"å¾Œã‚ã«"},
      {english:"cut down", japanese:"åˆ‡ã‚Šå€’ã™"},
      {english:"building", japanese:"å»ºç‰©"},
      {english:"destroy", japanese:"ç ´å£Šã™ã‚‹"},
      {english:"shock", japanese:"è¡æ’ƒ"},
      {english:"environment", japanese:"ç’°å¢ƒ"},
      {english:"guide", japanese:"æ¡ˆå†…ã™ã‚‹"},
      {english:"tour", japanese:"ãƒ„ã‚¢ãƒ¼"},
      {english:"simply", japanese:"å˜ç´”ã«"},
      {english:"nothing", japanese:"ä½•ã‚‚"},
      {english:"worry", japanese:"å¿ƒé…ã™ã‚‹"},
      {english:"decide", japanese:"æ±ºã‚ã‚‹"},
      {english:"major", japanese:"ä¸»è¦ãª"},
      {english:"less", japanese:"ã‚ˆã‚Šå°‘ãªã„"},
      {english:"sell", japanese:"å£²ã‚‹"},
      {english:"sold", japanese:"å£²ã‚‰ã‚ŒãŸ"},
      {english:"knowledge", japanese:"çŸ¥è­˜"},
      {english:"itself", japanese:"ãã‚Œè‡ªèº«"},
      {english:"share", japanese:"å…±æœ‰ã™ã‚‹"},
    ],
    9: [
      {english:"billion", japanese:"ï¼‘ï¼å„„"},
      {english:"than", japanese:"ã€‚ã€‚ã€‚ã‚ˆã‚Šã‚‚"},
      {english:"more than...", japanese:"ã€‚ã€‚ã€‚ã‚ˆã‚Šå¤šãã®"},
      {english:"dirty", japanese:"æ±šã‚Œã‚‹"},
      {english:"directly", japanese:"ç›´æŽ¥"},
      {english:"pond", japanese:"æ± "},
      {english:"should", japanese:"ã™ã¹ãã§ã‚ã‚‹"},
      {english:"presentation", japanese:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³"},
      {english:"everywhere", japanese:"ã©ã“ã§ã‚‚"},
      {english:"imagine", japanese:"æƒ³åƒã™ã‚‹"},
      {english:"step", japanese:"ä¸€æ­©"},
      {english:"situation", japanese:"äº‹æ…‹"},
      {english:"one of...", japanese:"ã®ä¸€ã¤ãƒ»ä¸€äºº"},
      {english:"collect", japanese:"é›†ã‚ã‚‹"},
      {english:"drinking water", japanese:"é£²ã¿æ°´"},
      {english:"understand", japanese:"ç†è§£ã™ã‚‹"},
      {english:"laundry", japanese:"æ´—æ¿¯ç‰©"},
      {english:"available", japanese:"åˆ©ç”¨ã§ãã‚‹"},
      {english:"post", japanese:"éƒµä¾¿"},
      {english:"store", japanese:"åº—"},
      {english:"office", japanese:"äº‹å‹™æ‰€"},
    ],
    10: [
      {english:"minute", japanese:"åˆ†"},
      {english:"before", japanese:"ã®å‰ã«"},
      {english:"photography", japanese:"å†™çœŸæ’®å½±"},
      {english:"tournament", japanese:"ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ"},
      {english:"against", japanese:"ã«å¯¾æŠ—ã—ã¦"},
      {english:"lost", japanese:"è² ã‘ã£ãŸ"},
      {english:"lose", japanese:"è² ã‘ã‚‹"},
      {english:"final", japanese:"æœ€å¾Œã®"},
      {english:"second", japanese:"ç§’"},
      {english:"broke", japanese:"å£Šã—ãŸ"},
      {english:"surely", japanese:"ç¢ºã‹ã«"},
      {english:"until", japanese:"ã€‚ã€‚ã€‚ã¾ã§"},
      {english:"half", japanese:"åŠåˆ†ã®"},
      {english:"hour", japanese:"ï¼‘æ™‚é–“"},
      {english:"tomorrow", japanese:"æ˜Žæ—¥"},
      {english:"today", japanese:"ä»Šæ—¥"},
      {english:"yesterday", japanese:"æ˜¨æ—¥"},
      {english:"ago", japanese:"ï½žå‰ã«"},
      {english:"spread", japanese:"åºƒã‚ã‚‹"},
    ],
    11: [
      {english:"kitchen", japanese:"å°æ‰€"},
      {english:"must", japanese:"ã€œã—ãªã‘ã‚Œã°ãªã‚‰ãªã„"},
      {english:"mask", japanese:"ãƒžã‚¹ã‚¯"},
      {english:"smartphone", japanese:"ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³"},
      {english:"back", japanese:"æˆ»ã‚‹"},
      {english:"return", japanese:"è¿”ã™"},
      {english:"week", japanese:"é€±"},
      {english:"quiet", japanese:"é™ã‹ãª"},
      {english:"future", japanese:"æœªæ¥"},
      {english:"in the future", japanese:"å°†æ¥"},
      {english:"somewhere", japanese:"ã©ã“ã‹ã«"},
      {english:"explore", japanese:"æŽ¢æ¤œã™ã‚‹"},
      {english:"clothes", japanese:"æœ"},
      {english:"design", japanese:"ãƒ‡ã‚¶ã‚¤ãƒ³"},
      {english:"chef", japanese:"ã‚·ã‚§ãƒ•"},
    ],
    12: [
      {english:"as", japanese:"ã€œã¨ã—ã¦"},
      {english:"behind", japanese:"å¾Œã‚ã«"},
      {english:"cut down", japanese:"åˆ‡ã‚Šå€’ã™"},
      {english:"building", japanese:"å»ºç‰©"},
      {english:"destroy", japanese:"ç ´å£Šã™ã‚‹"},
      {english:"shock", japanese:"è¡æ’ƒ"},
      {english:"environment", japanese:"ç’°å¢ƒ"},
      {english:"guide", japanese:"æ¡ˆå†…ã™ã‚‹"},
      {english:"tour", japanese:"ãƒ„ã‚¢ãƒ¼"},
      {english:"simply", japanese:"å˜ç´”ã«"},
      {english:"nothing", japanese:"ä½•ã‚‚"},
      {english:"worry", japanese:"å¿ƒé…ã™ã‚‹"},
      {english:"decide", japanese:"æ±ºã‚ã‚‹"},
      {english:"major", japanese:"ä¸»è¦ãª"},
      {english:"less", japanese:"ã‚ˆã‚Šå°‘ãªã„"},
      {english:"sell", japanese:"å£²ã‚‹"},
      {english:"sold", japanese:"å£²ã‚‰ã‚ŒãŸ"},
      {english:"knowledge", japanese:"çŸ¥è­˜"},
      {english:"itself", japanese:"ãã‚Œè‡ªèº«"},
      {english:"share", japanese:"å…±æœ‰ã™ã‚‹"},
    ],
    13: [
      {english:"billion", japanese:"ï¼‘ï¼å„„"},
      {english:"than", japanese:"ã€‚ã€‚ã€‚ã‚ˆã‚Šã‚‚"},
      {english:"more than...", japanese:"ã€‚ã€‚ã€‚ã‚ˆã‚Šå¤šãã®"},
      {english:"dirty", japanese:"æ±šã‚Œã‚‹"},
      {english:"directly", japanese:"ç›´æŽ¥"},
      {english:"pond", japanese:"æ± "},
      {english:"should", japanese:"ã™ã¹ãã§ã‚ã‚‹"},
      {english:"presentation", japanese:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³"},
      {english:"everywhere", japanese:"ã©ã“ã§ã‚‚"},
      {english:"imagine", japanese:"æƒ³åƒã™ã‚‹"},
      {english:"step", japanese:"ä¸€æ­©"},
      {english:"situation", japanese:"äº‹æ…‹"},
      {english:"one of...", japanese:"ã®ä¸€ã¤ãƒ»ä¸€äºº"},
      {english:"collect", japanese:"é›†ã‚ã‚‹"},
      {english:"drinking water", japanese:"é£²ã¿æ°´"},
      {english:"understand", japanese:"ç†è§£ã™ã‚‹"},
      {english:"laundry", japanese:"æ´—æ¿¯ç‰©"},
      {english:"available", japanese:"åˆ©ç”¨ã§ãã‚‹"},
      {english:"post", japanese:"éƒµä¾¿"},
      {english:"store", japanese:"åº—"},
      {english:"office", japanese:"äº‹å‹™æ‰€"},
    ],
    14: [
      {english:"billion", japanese:"ï¼‘ï¼å„„"},
      {english:"than", japanese:"ã€‚ã€‚ã€‚ã‚ˆã‚Šã‚‚"},
      {english:"more than...", japanese:"ã€‚ã€‚ã€‚ã‚ˆã‚Šå¤šãã®"},
      {english:"dirty", japanese:"æ±šã‚Œã‚‹"},
      {english:"directly", japanese:"ç›´æŽ¥"},
      {english:"pond", japanese:"æ± "},
      {english:"should", japanese:"ã™ã¹ãã§ã‚ã‚‹"},
      {english:"presentation", japanese:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³"},
      {english:"everywhere", japanese:"ã©ã“ã§ã‚‚"},
      {english:"imagine", japanese:"æƒ³åƒã™ã‚‹"},
      {english:"step", japanese:"ä¸€æ­©"},
      {english:"situation", japanese:"äº‹æ…‹"},
      {english:"one of...", japanese:"ã®ä¸€ã¤ãƒ»ä¸€äºº"},
      {english:"collect", japanese:"é›†ã‚ã‚‹"},
      {english:"drinking water", japanese:"é£²ã¿æ°´"},
      {english:"understand", japanese:"ç†è§£ã™ã‚‹"},
      {english:"laundry", japanese:"æ´—æ¿¯ç‰©"},
      {english:"available", japanese:"åˆ©ç”¨ã§ãã‚‹"},
      {english:"post", japanese:"éƒµä¾¿"},
      {english:"store", japanese:"åº—"},
      {english:"office", japanese:"äº‹å‹™æ‰€"},
    ],
    15: [
      {english:"minute", japanese:"åˆ†"},
      {english:"before", japanese:"ã®å‰ã«"},
      {english:"photography", japanese:"å†™çœŸæ’®å½±"},
      {english:"tournament", japanese:"ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ"},
      {english:"against", japanese:"ã«å¯¾æŠ—ã—ã¦"},
      {english:"lost", japanese:"è² ã‘ã£ãŸ"},
      {english:"lose", japanese:"è² ã‘ã‚‹"},
      {english:"final", japanese:"æœ€å¾Œã®"},
      {english:"second", japanese:"ç§’"},
      {english:"broke", japanese:"å£Šã—ãŸ"},
      {english:"surely", japanese:"ç¢ºã‹ã«"},
      {english:"until", japanese:"ã€‚ã€‚ã€‚ã¾ã§"},
      {english:"half", japanese:"åŠåˆ†ã®"},
      {english:"hour", japanese:"ï¼‘æ™‚é–“"},
      {english:"tomorrow", japanese:"æ˜Žæ—¥"},
      {english:"today", japanese:"ä»Šæ—¥"},
      {english:"yesterday", japanese:"æ˜¨æ—¥"},
      {english:"ago", japanese:"ï½žå‰ã«"},
      {english:"spread", japanese:"åºƒã‚ã‚‹"},
    ],
  };

  // Globals
  const lessonButtonsDiv = document.getElementById('lesson-buttons');
  const gameGrid = document.getElementById('game-grid');
  const startMenu = document.getElementById('start-menu');
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const progressContainer = document.getElementById('progress-container');
  const progressBar = document.getElementById('progress-bar');
  const streakCounter = document.getElementById('streak-counter');
  const confettiCanvas = document.getElementById('confetti-canvas');
  const confettiCtx = confettiCanvas.getContext('2d');

  let draggedElement = null;
  let originalPos = {x:0, y:0};
  let matchesMade = 0;
  let totalMatches = 0;
  let streak = 0;
  let confettiActive = false;

  // Initialize lesson buttons dynamically
  function createLessonButtons() {
    lessonButtonsDiv.innerHTML = '';
    lessons.forEach((lesson,i) => {
      const btn = document.createElement('button');
      btn.textContent = lesson.name;
      btn.onclick = () => startGame(i);
      lessonButtonsDiv.appendChild(btn);
    });
  }
  createLessonButtons();

  // Dark mode toggle logic
  darkModeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
  });

  // Start game
  function startGame(index) {
    startMenu.style.display = 'none';
    gameGrid.style.display = 'grid';
    progressContainer.style.display = 'block';
    streakCounter.style.display = 'block';
    gameGrid.innerHTML = '';
    streak = 0;
    updateStreak(0);

    const words = lessons[index].words;
    totalMatches = words.length;
    matchesMade = 0;
    updateProgress();

    // Shuffle words array
    const shuffled = [...words].sort(() => Math.random() - 0.5);

    // Create English draggable boxes (left 2 columns)
    shuffled.forEach(pair => {
      const engDiv = document.createElement('div');
      engDiv.className = 'draggable';
      engDiv.textContent = pair.english;
      engDiv.setAttribute('draggable', 'true');
      engDiv.dataset.word = pair.english;
      engDiv.style.touchAction = 'none';

      engDiv.addEventListener('dragstart', dragStart);
      engDiv.addEventListener('dragend', dragEnd);
      engDiv.addEventListener('touchstart', touchStart, {passive:false});
      gameGrid.appendChild(engDiv);
    });

    // Create Japanese droppable boxes (right 2 columns)
    shuffled.forEach(pair => {
      const japDiv = document.createElement('div');
      japDiv.className = 'droppable';
      japDiv.textContent = pair.japanese;
      japDiv.dataset.match = pair.english;
      japDiv.addEventListener('dragover', e => e.preventDefault());
      japDiv.addEventListener('drop', dropHandler);
      gameGrid.appendChild(japDiv);
    });
  }

  // Drag handlers for mouse
  function dragStart(e) {
    draggedElement = e.target;
    originalPos = {
      x: draggedElement.offsetLeft,
      y: draggedElement.offsetTop
    };
    e.dataTransfer.setData('text/plain', draggedElement.dataset.word);
    setTimeout(() => draggedElement.classList.add('hide'), 0);

    // Play audio of English word using speech synthesis
    playAudio(draggedElement.dataset.word);
  }

  function dragEnd(e) {
    if (draggedElement) draggedElement.classList.remove('hide');
    draggedElement = null;
  }

  // Drop handler for mouse drag
  function dropHandler(e) {
    e.preventDefault();
    if (!draggedElement) return;

    const dropTarget = e.target.closest('.droppable');
    if (!dropTarget) return;

    if (dropTarget.dataset.match === draggedElement.dataset.word) {
      handleCorrectMatch(draggedElement, dropTarget);
    } else {
      handleIncorrectMatch(draggedElement);
    }
  }

  // Touch drag handlers
  let touchData = null;

  function touchStart(e) {
    e.preventDefault();
    draggedElement = e.target;
    draggedElement.classList.add('dragging-touch');
    draggedElement.style.position = 'absolute';
    draggedElement.style.zIndex = 1000;

    const touch = e.touches[0];
    const rect = draggedElement.getBoundingClientRect();

    touchData = {
      startX: touch.clientX,
      startY: touch.clientY,
      offsetX: touch.clientX - rect.left,
      offsetY: touch.clientY - rect.top
    };

    moveAt(touch.clientX, touch.clientY);

    document.addEventListener('touchmove', touchMove, {passive:false});
    document.addEventListener('touchend', touchEnd);

    // Play audio
    playAudio(draggedElement.dataset.word);
  }

  function touchMove(e) {
    e.preventDefault();
    const touch = e.touches[0];
    moveAt(touch.clientX, touch.clientY);
  }

  function moveAt(clientX, clientY) {
    if (!draggedElement) return;
    draggedElement.style.left = (clientX - touchData.offsetX) + 'px';
    draggedElement.style.top = (clientY - touchData.offsetY) + 'px';
  }

  function touchEnd(e) {
    e.preventDefault();
    if (!draggedElement) return;
    draggedElement.classList.remove('dragging-touch');

    const touch = e.changedTouches[0];
    const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.droppable');

    if (dropTarget && dropTarget.dataset.match === draggedElement.dataset.word) {
      handleCorrectMatch(draggedElement, dropTarget);
    } else {
      handleIncorrectMatch(draggedElement);
    }

    resetDraggedElementStyles();
  }

  // Helpers
  function resetDraggedElementStyles() {
    if (!draggedElement) return;
    draggedElement.style.position = '';
    draggedElement.style.left = '';
    draggedElement.style.top = '';
    draggedElement.style.zIndex = '';
    draggedElement = null;
  }

  // Correct match handler
  function handleCorrectMatch(draggable, droppable) {
    // Append draggable to droppable, snap with animation
    droppable.innerHTML = '';
    droppable.appendChild(draggable);
    droppable.classList.add('matched');
    draggable.classList.add('matched');
    draggable.setAttribute('draggable', 'false');

    // Reset styles for positioning
    draggable.style.position = '';
    draggable.style.left = '';
    draggable.style.top = '';
    draggable.style.zIndex = '';
    draggable.style.transition = 'transform 0.3s ease';

    // Snap visually: reset transform
    draggable.style.transform = 'translate(0,0)';

    // Play sparkle animation
    createSparkle(droppable);

    matchesMade++;
    updateProgress();

    // Update streak
    streak++;
    updateStreak(streak);

    // Check if all matched
    if (matchesMade >= totalMatches) {
      triggerConfetti();
      setTimeout(() => alert('ðŸŽ‰ Congratulations! All matched! ðŸŽ‰'), 500);
    }
  }

  // Incorrect match handler
  function handleIncorrectMatch(draggable) {
    streak = 0;
    updateStreak(streak);
    shakeAndBounceBack(draggable);
  }

  // Shake red and bounce back animation
  function shakeAndBounceBack(el) {
    if (!el) return;

    el.classList.add('shake');
    el.style.transition = 'transform 0.5s ease';

    // Bounce back to original position (for touch drag)
    el.style.transform = 'translate(0, 0)';

    setTimeout(() => {
      el.classList.remove('shake');
      el.style.transition = '';
      el.style.transform = '';
    }, 500);
  }

  // Update progress bar
  function updateProgress() {
    const percent = (matchesMade / totalMatches) * 100;
    progressBar.style.width = percent + '%';
  }

  // Update streak display
  function updateStreak(value) {
    if (value > 0) {
      streakCounter.textContent = `Streak: ${value} ðŸ”¥`;
      streakCounter.style.color = '#d6336c';
    } else {
      streakCounter.textContent = 'Streak: 0';
      streakCounter.style.color = '#777';
    }
  }

  // Play audio for English word using SpeechSynthesis
  function playAudio(text) {
    if (!window.speechSynthesis) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    window.speechSynthesis.cancel(); // cancel previous
    window.speechSynthesis.speak(utterance);
  }

  // Sparkle effect creation
  function createSparkle(parent) {
    const sparkle = document.createElement('div');
    sparkle.className = 'sparkle';
    parent.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 800);
  }

  // Confetti implementation
  let confettiParticles = [];
  let confettiAnimationId = null;

  function triggerConfetti() {
    if (confettiActive) return;
    confettiActive = true;
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;

    confettiParticles = [];
    const colors = ['#d6336c', '#ff96b8', '#57d26f', '#38b0de', '#ffd23f'];

    for (let i = 0; i < 150; i++) {
      confettiParticles.push({
        x: Math.random() * confettiCanvas.width,
        y: Math.random() * confettiCanvas.height - confettiCanvas.height,
        r: (Math.random() * 6) + 4,
        d: (Math.random() * 20) + 10,
        color: colors[Math.floor(Math.random() * colors.length)],
        tilt: Math.floor(Math.random() * 10) - 10,
        tiltAngleIncremental: (Math.random() * 0.07) + 0.05,
        tiltAngle: 0
      });
    }
    animateConfetti();
  }

  function animateConfetti() {
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    confettiParticles.forEach(p => {
      p.tiltAngle += p.tiltAngleIncremental;
      p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
      p.x += Math.sin(p.tiltAngle) * 2;
      p.tilt = Math.sin(p.tiltAngle) * 15;

      confettiCtx.beginPath();
      confettiCtx.lineWidth = p.r;
      confettiCtx.strokeStyle = p.color;
      confettiCtx.moveTo(p.x + p.tilt + p.r / 2, p.y);
      confettiCtx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 2);
      confettiCtx.stroke();

      if (p.y > confettiCanvas.height) {
        p.x = Math.random() * confettiCanvas.width;
        p.y = -10;
      }
    });
    confettiAnimationId = requestAnimationFrame(animateConfetti);
    // Stop confetti after 6 seconds
    setTimeout(stopConfetti, 6000);
  }
  function stopConfetti() {
    confettiActive = false;
    cancelAnimationFrame(confettiAnimationId);
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  }

  // Resize canvas on window resize
  window.addEventListener('resize', () => {
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
  });

</script>

</body>
</html>
