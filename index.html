<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vocabulary Match Game</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Nico+Moji&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg: #fdf6f0;
    --primary: #f9c6d0;
    --hover: #ffe1e9;
    --match: #c7f9cc;
    --text: #333;
    --accent: #ffb5d2;
  }
  body.dark-mode {
    --bg: #1e1e2f;
    --primary: #5e548e;
    --hover: #7c6fb0;
    --match: #98c1d9;
    --text: #f5f5f5;
    --accent: #ffb5d2;
  }
  body {
    margin: 0;
    font-family: 'Comic Neue', cursive;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #start-menu, #game-screen, #end-screen {
    max-width: 1000px;
    width: 100%;
    padding: 20px;
    display: none;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  #start-menu.active, #game-screen.active, #end-screen.active {
    display: flex;
  }
  .title {
    font-size: 2.5rem;
    margin: 20px;
    color: #d85f84;
  }
  button {
    font-family: 'Comic Neue', cursive;
    padding: 12px 24px;
    margin: 10px;
    font-size: 1.2rem;
    background: var(--primary);
    border: none;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s;
  }
  button:hover {
    background: var(--hover);
    transform: scale(1.05);
  }
  .grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    width: 100%;
    max-width: 900px;
  }
  .grid-column {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  .card {
    background: white;
    padding: 15px;
    text-align: center;
    font-size: 1.2rem;
    border-radius: 10px;
    font-family: 'Nico Moji', sans-serif;
    user-select: none;
    position: relative;
    min-height: 60px;
  }
  .draggable {
    cursor: grab;
    position: relative;
    z-index: 10;
  }
  .droppable {
    border: 2px dashed transparent;
    position: relative;
    min-height: 60px;
  }
  .droppable.over {
    border-color: var(--primary);
  }
  .matched {
    background: var(--match) !important;
    pointer-events: none;
  }
  #timer {
    font-size: 1.2rem;
    color: var(--accent);
    margin-bottom: 15px;
  }
</style>
</head>
<body>
  <div id="start-menu" class="active">
    <h1 class="title">ğŸ€ Vocabulary Match Game ğŸ€</h1>
    <button data-set="0">Lesson 1</button>
    <button data-set="1">Lesson 2</button>
    <button data-set="0" data-challenge="true">Challenge Mode ğŸ”¥</button>
    <button id="dark-mode-toggle">ğŸŒ“ Toggle Dark Mode</button>
  </div>

  <div id="game-screen">
    <h2 class="title">ğŸ¯ Drag English Words to Match</h2>
    <div id="timer"></div>
    <div class="grid-container">
      <div class="grid-column" id="english-column"></div>
      <div class="grid-column" id="japanese-column"></div>
    </div>
    <button id="back-button">â¬…ï¸ Back to Menu</button>
  </div>

  <div id="end-screen">
    <h2>âœ¨ All Pairs Matched! âœ¨</h2>
    <p><strong>â± Time Taken:</strong> <span id="score-time"></span></p>
    <p><strong>âœ… Matches Made:</strong> <span id="score-matches"></span></p>
    <p><strong>âŒ Mistakes:</strong> <span id="score-mistakes"></span></p>
    <button id="play-again-button">ğŸ” Play Again</button>
  </div>

  <canvas id="confetti-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    let countdown;
    let selectedSet;
    let matchedPairs;
    let startTime;
    let mistakeCount;
    let isChallenge = false;

    const timerDisplay = document.getElementById('timer');
    const startMenu = document.getElementById('start-menu');
    const gameScreen = document.getElementById('game-screen');
    const endScreen = document.getElementById('end-screen');
    const englishColumn = document.getElementById('english-column');
    const japaneseColumn = document.getElementById('japanese-column');

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }

    function startGame(setIndex, challenge = false) {
      selectedSet = sets[setIndex];
      isChallenge = challenge;
      startMenu.classList.remove('active');
      gameScreen.classList.add('active');
      endScreen.classList.remove('active');
      matchedPairs = 0;
      mistakeCount = 0;
      startTime = Date.now();
      timerDisplay.textContent = "";
      buildGrid();
      if (isChallenge) {
        let timeLeft = 120;
        timerDisplay.textContent = `â±ï¸ ${timeLeft}s remaining`;
        countdown = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = `â±ï¸ ${timeLeft}s remaining`;
          if (timeLeft <= 0) {
            clearInterval(countdown);
            alert("â° Time's up! Try again!");
            goBack();
          }
        }, 1000);
      }
    }

    function buildGrid() {
      englishColumn.innerHTML = '';
      japaneseColumn.innerHTML = '';
      const engWords = [...selectedSet.words].sort(() => Math.random() - 0.5);
      const japWords = [...selectedSet.words].sort(() => Math.random() - 0.5);

      engWords.forEach(word => {
        const card = document.createElement('div');
        card.className = 'card draggable';
        card.draggable = true;
        card.textContent = word.english;
        card.dataset.match = word.japanese;

        card.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', word.english);

          // Create clone for drag image to look exactly like the card
          const dragIcon = card.cloneNode(true);
          dragIcon.style.position = 'absolute';
          dragIcon.style.top = '-1000px';  // hide it offscreen
          dragIcon.style.left = '-1000px';
          dragIcon.style.width = `${card.offsetWidth}px`;
          dragIcon.style.height = `${card.offsetHeight}px`;
          document.body.appendChild(dragIcon);

          e.dataTransfer.setDragImage(dragIcon, card.offsetWidth / 2, card.offsetHeight / 2);

          setTimeout(() => {
            document.body.removeChild(dragIcon);
          }, 0);

          playAudio(word.english);
        });

        englishColumn.appendChild(card);
      });

      japWords.forEach(word => {
        const card = document.createElement('div');
        card.className = 'card droppable';
        card.textContent = word.japanese;
        card.dataset.match = word.english;
        card.addEventListener('dragover', e => e.preventDefault());
        card.addEventListener('drop', e => {
          e.preventDefault();
          const draggedText = e.dataTransfer.getData('text/plain');
          const matchCard = [...englishColumn.children].find(c => c.textContent === draggedText);

          if (!matchCard || matchCard.classList.contains('matched') || card.classList.contains('matched')) return;

          if (card.dataset.match === draggedText) {
            card.classList.add('matched');
            matchCard.classList.add('matched');

            // Keep original size and center English card on Japanese card
            const rect = matchCard.getBoundingClientRect();

            card.style.position = 'relative';
            card.appendChild(matchCard);

            matchCard.style.position = 'absolute';
            matchCard.style.top = '50%';
            matchCard.style.left = '50%';
            matchCard.style.transform = 'translate(-50%, -50%)';
            matchCard.style.width = `${rect.width}px`;
            matchCard.style.height = `${rect.height}px`;
            matchCard.style.margin = '0';
            matchCard.style.cursor = 'default';
            matchCard.style.pointerEvents = 'none'; // prevent interaction
            matchCard.draggable = false;

            matchedPairs++;
            if (matchedPairs === selectedSet.words.length) {
              if (isChallenge) clearInterval(countdown);
              const timeTaken = Math.floor((Date.now() - startTime) / 1000);
              document.getElementById('score-time').textContent = `${timeTaken} seconds`;
              document.getElementById('score-matches').textContent = matchedPairs;
              document.getElementById('score-mistakes').textContent = mistakeCount;
              setTimeout(() => {
                gameScreen.classList.remove('active');
                endScreen.classList.add('active');
                confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
              }, 300);
            }
          } else {
            mistakeCount++;
            card.style.backgroundColor = '#ffcccc';
            matchCard.style.transition = 'transform 0.3s ease';
            matchCard.style.transform = 'translateX(-40px)';
            setTimeout(() => {
              matchCard.style.transform = 'translateX(40px)';
              setTimeout(() => {
                matchCard.style.transform = 'translateX(0)';
                matchCard.style.transition = '';
                card.style.backgroundColor = '';
              }, 200);
            }, 200);
          }
        });
        japaneseColumn.appendChild(card);
      });
    }

    function goBack() {
      clearInterval(countdown);
      gameScreen.classList.remove('active');
      endScreen.classList.remove('active');
      startMenu.classList.add('active');
    }

    function playAudio(word) {
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
    }

    // Event delegation for start menu buttons
    startMenu.addEventListener('click', e => {
      if (e.target.tagName === 'BUTTON') {
        const setIndex = e.target.getAttribute('data-set');
        const challenge = e.target.getAttribute('data-challenge') === 'true';
        if (setIndex !== null) {
          startGame(parseInt(setIndex), challenge);
        }
      }
    });

    // Dark mode toggle
    document.getElementById('dark-mode-toggle').addEventListener('click', toggleDarkMode);

    // Back button
    document.getElementById('back-button').addEventListener('click', goBack);

    // Play again button
    document.getElementById('play-again-button').addEventListener('click', () => {
      endScreen.classList.remove('active');
      startMenu.classList.add('active');
    });

    const sets = [
      {
        name: "Lesson 1",
        words: [
          { english: "apple", japanese: "ã‚Šã‚“ã”" },
          { english: "book", japanese: "æœ¬" },
          { english: "school", japanese: "å­¦æ ¡" },
          { english: "pen", japanese: "ãƒšãƒ³" },
          { english: "water", japanese: "æ°´" },
          { english: "dog", japanese: "çŠ¬" },
          { english: "cat", japanese: "çŒ«" },
          { english: "chair", japanese: "æ¤…å­" },
          { english: "table", japanese: "ãƒ†ãƒ¼ãƒ–ãƒ«" },
          { english: "teacher", japanese: "å…ˆç”Ÿ" },
          { english: "student", japanese: "ç”Ÿå¾’" },
          { english: "car", japanese: "è»Š" },
          { english: "bus", japanese: "ãƒã‚¹" },
          { english: "music", japanese: "éŸ³æ¥½" },
          { english: "movie", japanese: "æ˜ ç”»" },
          { english: "flower", japanese: "èŠ±" },
          { english: "sky", japanese: "ç©º" },
          { english: "tree", japanese: "æœ¨" },
          { english: "fish", japanese: "é­š" },
          { english: "bird", japanese: "é³¥" }
        ]
      },
      {
        name: "Lesson 2",
        words: [
          { english: "run", japanese: "èµ°ã‚‹" },
          { english: "jump", japanese: "è·³ã¶" },
          { english: "read", japanese: "èª­ã‚€" },
          { english: "write", japanese: "æ›¸ã" },
          { english: "eat", japanese: "é£Ÿã¹ã‚‹" },
          { english: "drink", japanese: "é£²ã‚€" },
          { english: "laugh", japanese: "ç¬‘ã†" },
          { english: "cry", japanese: "æ³£ã" },
          { english: "talk", japanese: "è©±ã™" },
          { english: "listen", japanese: "èã" },
          { english: "sleep", japanese: "å¯ã‚‹" },
          { english: "wake", japanese: "èµ·ãã‚‹" },
          { english: "walk", japanese: "æ­©ã" },
          { english: "swim", japanese: "æ³³ã" },
          { english: "study", japanese: "å‹‰å¼·ã™ã‚‹" },
          { english: "play", japanese: "éŠã¶" },
          { english: "cook", japanese: "æ–™ç†ã™ã‚‹" },
          { english: "draw", japanese: "æã" },
          { english: "paint", japanese: "çµµã‚’æã" },
          { english: "sing", japanese: "æ­Œã†" }
        ]
      }
    ];
  </script>
</body>
</html>
