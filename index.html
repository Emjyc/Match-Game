<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Match Game</title>
  <style>
    body {
      font-family: 'Comic Neue', sans-serif;
      background-color: #fefefe;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .dark {
      background-color: #1e1e1e;
      color: #fff;
    }
    #darkToggle {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 24px;
      cursor: pointer;
    }
    #startScreen, #gameScreen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      width: 100%;
    }
    #startScreen.active, #gameScreen.active {
      display: flex;
    }
    .set-button {
      padding: 10px 20px;
      margin: 10px;
      background-color: #f6c23e;
      border: none;
      border-radius: 10px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      font-size: 18px;
    }
    #timerContainer {
      width: 80%;
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px auto;
      height: 30px;
      position: relative;
    }
    #timerBar {
      height: 100%;
      width: 100%;
      background-color: #f67280;
      transition: width 0.3s;
    }
    .shake {
      animation: shake 0.5s infinite;
    }
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      25% { transform: translate(-1px, -2px) rotate(-1deg); }
      50% { transform: translate(-3px, 0px) rotate(1deg); }
      75% { transform: translate(3px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -1px) rotate(1deg); }
    }
    #gameGrid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 20px;
      width: 80%;
    }
    .english-word, .japanese-word {
      padding: 10px;
      background-color: #fff3cd;
      border-radius: 8px;
      text-align: center;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      cursor: grab;
    }
    .correct {
      background-color: #88d8b0 !important;
    }
    .incorrect {
      background-color: #ff6f69 !important;
    }
    .matched {
      background-color: #d3e5ff !important;
    }
    #popupOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    #popupOverlay.visible {
      display: flex;
    }
    #popupContent {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="darkToggle">üåô</div>

  <div id="startScreen" class="active">
    <h1>üéå English-Japanese Match Game üéå</h1>
    <button class="set-button" onclick="launchGame(1)">Set 1</button>
    <button class="set-button" onclick="launchGame(2)">Set 2</button>
    <button class="set-button" onclick="launchGame(3)">Set 3</button>
    <button class="set-button" onclick="launchGame(4)">Set 4</button>
    <button class="set-button" onclick="launchGame(5)">Set 5</button>
  </div>

  <div id="gameScreen">
    <div id="timerContainer"><div id="timerBar"></div></div>
    <p id="timerText">05:00</p>
    <div id="matchProgressText">Matched 0 / 0</div>
    <div id="gameGrid"></div>
  </div>

  <div id="popupOverlay">
    <div id="popupContent">
      <h2>Finished!</h2>
      <p id="finalScore">„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≥„Ç¢: 0</p>
      <button id="restartButton">Back to Start</button>
    </div>
  </div>

  <canvas id="confettiCanvas"></canvas>

  <script>
const darkToggle = document.getElementById('darkToggle');
darkToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark');
  localStorage.setItem('darkMode', document.body.classList.contains('dark'));
});
if (localStorage.getItem('darkMode') === 'true') {
  document.body.classList.add('dark');
}

const timerText = document.getElementById("timerText");
const timerBar = document.getElementById("timerBar");
const timerContainer = document.getElementById("timerContainer");
const matchProgressBar = document.getElementById("matchProgressBar");
const matchProgressText = document.getElementById("matchProgressText");
const gameGrid = document.getElementById("gameGrid");
const popupOverlay = document.getElementById("popupOverlay");
const finalScoreText = document.getElementById("finalScore");
const restartButton = document.getElementById("restartButton");
const confettiCanvas = document.getElementById("confettiCanvas");

let timerInterval;
let timeLeft = 300;
let score = 0;
let matchedPairs = 0;
let totalPairs = 0;

const setsData = {
  1: [{english:"apple",japanese:"„Çä„Çì„Åî"}, {english:"dog",japanese:"Áä¨"}, {english:"water",japanese:"Ê∞¥"}, {english:"book",japanese:"Êú¨"}, {english:"school",japanese:"Â≠¶Ê†°"}, {english:"cat",japanese:"Áå´"}],
  2: [{english:"car",japanese:"Ëªä"}, {english:"chair",japanese:"Ê§ÖÂ≠ê"}, {english:"tree",japanese:"Êú®"}, {english:"sun",japanese:"Â§™ÈôΩ"}, {english:"rain",japanese:"Èõ®"}, {english:"mountain",japanese:"Â±±"}],
  3: [{english:"friend",japanese:"ÂèãÈÅî"}, {english:"computer",japanese:"„Ç≥„É≥„Éî„É•„Éº„Çø„Éº"}, {english:"phone",japanese:"ÈõªË©±"}, {english:"city",japanese:"ÈÉΩÂ∏Ç"}, {english:"river",japanese:"Â∑ù"}, {english:"flower",japanese:"Ëä±"}],
  4: [{english:"music",japanese:"Èü≥Ê•Ω"}, {english:"movie",japanese:"Êò†Áîª"}, {english:"game",japanese:"„Ç≤„Éº„É†"}, {english:"food",japanese:"È£ü„ÅπÁâ©"}, {english:"drink",japanese:"È£≤„ÅøÁâ©"}, {english:"travel",japanese:"ÊóÖË°å"}],
  5: [{english:"write",japanese:"Êõ∏„Åè"}, {english:"read",japanese:"Ë™≠„ÇÄ"}, {english:"listen",japanese:"ËÅû„Åè"}, {english:"speak",japanese:"Ë©±„Åô"}, {english:"run",japanese:"Ëµ∞„Çã"}, {english:"jump",japanese:"Ë∑≥„Å∂"}]
};

function launchGame(setNumber) {
  document.getElementById("startScreen").classList.remove("active");
  document.getElementById("gameScreen").classList.add("active");
  const pairs = setsData[setNumber];
  totalPairs = pairs.length;

  const shuffledEnglish = [...pairs].sort(() => Math.random() - 0.5).map(p => p.english);
  const shuffledJapanese = [...pairs].sort(() => Math.random() - 0.5).map(p => p.japanese);

  shuffledEnglish.forEach(word => {
    const div = document.createElement("div");
    div.className = "english-word";
    div.textContent = word;
    div.setAttribute("draggable", true);
    div.dataset.word = word;
    div.addEventListener("dragstart", e => {
      e.dataTransfer.setData("text/plain", word);
      playAudio(word);
    });
    gameGrid.appendChild(div);
  });

  shuffledJapanese.forEach(word => {
    const div = document.createElement("div");
    div.className = "japanese-word";
    div.textContent = word;
    div.dataset.word = word;
    div.addEventListener("dragover", e => e.preventDefault());
    div.addEventListener("drop", e => {
      e.preventDefault();
      const dragged = e.dataTransfer.getData("text/plain");
      handleDrop(dragged, div, pairs);
    });
    gameGrid.appendChild(div);
  });

  updateProgress();
  updateTimerUI();
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerUI();
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      endGame();
    }
  }, 1000);
}

function updateTimerUI() {
  timerText.textContent = `${String(Math.floor(timeLeft / 60)).padStart(2, '0')}:${String(timeLeft % 60).padStart(2, '0')}`;
  timerBar.style.width = `${(timeLeft / 300) * 100}%`;
  if (timeLeft <= 30) {
    timerBar.style.backgroundColor = "#ff6f69";
    timerContainer.classList.add("shake");
  } else if (timeLeft <= 60) {
    timerBar.style.backgroundColor = "#ffcc5c";
    timerContainer.classList.remove("shake");
  } else {
    timerBar.style.backgroundColor = "#f67280";
    timerContainer.classList.remove("shake");
  }
}

function playAudio(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'en-US';
  speechSynthesis.cancel();
  speechSynthesis.speak(utterance);
}

function handleDrop(englishWord, japDiv, pairs) {
  const japWord = japDiv.dataset.word;
  const match = pairs.find(p => p.english === englishWord && p.japanese === japWord);
  const engDiv = [...document.querySelectorAll('.english-word')].find(el => el.dataset.word === englishWord);

  if (!engDiv || engDiv.classList.contains("correct")) return;

  if (match) {
    engDiv.classList.add("correct");
    japDiv.classList.add("matched");
    engDiv.setAttribute("draggable", false);
    matchedPairs++;
    score += 10;
    updateProgress();
    checkComplete();
  } else {
    engDiv.classList.add("incorrect");
    setTimeout(() => engDiv.classList.remove("incorrect"), 600);
  }
}

function updateProgress() {
  const percent = (matchedPairs / totalPairs) * 100;
  matchProgressBar.style.width = percent + "%";
  matchProgressText.textContent = `Matched ${matchedPairs} / ${totalPairs}`;
}

function checkComplete() {
  if (matchedPairs === totalPairs) {
    clearInterval(timerInterval);
    showConfetti();
    setTimeout(endGame, 2000);
  }
}

function endGame() {
  finalScoreText.textContent = `„ÅÇ„Å™„Åü„ÅÆ„Çπ„Ç≥„Ç¢: ${score}`;
  popupOverlay.classList.add("visible");
}

restartButton.addEventListener("click", () => {
  window.location.reload();
});

function showConfetti() {
  const ctx = confettiCanvas.getContext("2d");
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
  const colors = ["#f67280", "#f6c23e", "#88d8b0", "#ffcc5c"];
  const particles = Array.from({ length: 150 }, () => ({
    x: Math.random() * confettiCanvas.width,
    y: Math.random() * confettiCanvas.height - confettiCanvas.height,
    r: Math.random() * 6 + 4,
    d: Math.random() * 10 + 10,
    color: colors[Math.floor(Math.random() * colors.length)],
    tilt: Math.random() * 10 - 10,
    tiltAngleIncrement: Math.random() * 0.1 + 0.05,
    tiltAngle: 0
  }));

  function draw() {
    ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    particles.forEach(p => {
      ctx.beginPath();
      ctx.lineWidth = p.r / 2;
      ctx.strokeStyle = p.color;
      ctx.moveTo(p.x + p.tilt + p.r / 3, p.y);
      ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 3);
      ctx.stroke();
    });
    update();
  }

  function update() {
    particles.forEach(p => {
      p.tiltAngle += p.tiltAngleIncrement;
      p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
      p.x += Math.sin(p.d);
      p.tilt = Math.sin(p.tiltAngle) * 15;
      if (p.y > confettiCanvas.height) {
        p.x = Math.random() * confettiCanvas.width;
        p.y = -10;
      }
    });
  }

  let animationId;
  function run() {
    draw();
    animationId = requestAnimationFrame(run);
  }
  run();

  setTimeout(() => {
    cancelAnimationFrame(animationId);
    ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  }, 5000);
}
  </script>
</body>
</html>
