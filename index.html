<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vocabulary Match Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Comic Neue', cursive;
      margin: 0;
      padding: 0;
      background-color: #fff8f4;
      transition: background 0.4s, color 0.4s;
    }
    body.dark {
      background-color: #1e1e1e;
      color: #fefefe;
    }
    button {
      font-family: 'Comic Neue', cursive;
      padding: 10px 20px;
      font-size: 1.2em;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #ffccdc;
      transition: transform 0.2s, background 0.3s;
    }
    button:hover {
      transform: scale(1.05);
      background-color: #ffbcd0;
    }
    .title {
      text-align: center;
      font-size: 2.5em;
      margin: 20px 0;
    }
    #start-menu {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 20px;
    }
    #lesson-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      width: 90%;
      max-width: 800px;
    }
    #game-container {
      display: none;
      padding: 20px;
    }
    #game-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .draggable, .droppable {
      padding: 10px;
      border: 2px solid #ccc;
      background-color: #fff;
      text-align: center;
      border-radius: 8px;
      user-select: none;
      transition: all 0.3s;
      font-size: 1.1em;
    }
    .draggable {
      background-color: #f9f9ff;
      cursor: grab;
      position: relative;
    }
    .droppable {
      background-color: #eef6ff;
      min-height: 40px;
    }
    .matched {
      background-color: #c8f7c5 !important;
      border-color: #8ed18d !important;
    }
    .hide {
      visibility: hidden;
    }
    .bounce {
      animation: bounce 0.3s;
    }
    .flash-red {
      background-color: #ffb3b3 !important;
      border-color: red !important;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }
    #progress-container, #streak-counter {
      margin-top: 10px;
      text-align: center;
    }
    #progress-bar {
      height: 10px;
      background-color: #4caf50;
      width: 0%;
      transition: width 0.5s;
      border-radius: 5px;
    }
    #end-screen {
      display: none;
      text-align: center;
      padding: 30px;
    }
    canvas#confetti-canvas {
      position: fixed;
      pointer-events: none;
      top: 0;
      left: 0;
      z-index: 1000;
    }
    .dark .draggable,
    .dark .droppable {
      background-color: #333;
      border-color: #666;
      color: #fff;
    }
    .dark .droppable {
      background-color: #444;
    }
    .sparkle {
      animation: sparkle 1.2s ease-in-out infinite;
    }
    @keyframes sparkle {
      0%, 100% { text-shadow: 0 0 6px #fff, 0 0 12px #ff66cc, 0 0 18px #ff66cc; }
      50% { text-shadow: 0 0 3px #fff, 0 0 6px #ff66cc, 0 0 9px #ff66cc; }
    }
  </style>
</head>
<body>
  <div id="start-menu">
    <h1 class="title">Vocabulary Match Game</h1>
    <div id="lesson-buttons"></div>
    <button id="challenge-btn">üî• Challenge Mode</button>
    <button id="dark-mode-toggle">üåì Toggle Dark Mode</button>
  </div>

  <div id="game-container">
    <div id="progress-container"><div id="progress-bar"></div></div>
    <div id="streak-counter"></div>
    <div id="game-grid"></div>
  </div>

  <div id="end-screen">
    <h2 id="end-title"></h2>
    <p id="end-summary"></p>
    <p id="end-score"></p>
    <button id="restart-btn">üîÅ Try Again</button>
    <button id="back-to-menu-btn">üîô Back to Menu</button>
  </div>

  <canvas id="confetti-canvas"></canvas>
<script>
  // Confetti helper library (simple version)
  // Source: https://www.kirilv.com/canvas-confetti/
  class Confetti {
    constructor(canvas) {
      this.canvas = canvas;
      this.ctx = canvas.getContext('2d');
      this.particles = [];
      this.width = window.innerWidth;
      this.height = window.innerHeight;
      canvas.width = this.width;
      canvas.height = this.height;
      window.addEventListener('resize', () => {
        this.width = window.innerWidth;
        this.height = window.innerHeight;
        canvas.width = this.width;
        canvas.height = this.height;
      });
    }
    createParticle() {
      const colors = ['#ff66cc', '#ffb3d9', '#cc3399', '#ff99cc', '#ff4d94'];
      return {
        x: Math.random() * this.width,
        y: Math.random() * this.height - this.height,
        size: Math.random() * 7 + 3,
        speedY: Math.random() * 3 + 2,
        color: colors[Math.floor(Math.random() * colors.length)],
        opacity: 1,
        decay: Math.random() * 0.01 + 0.005,
      };
    }
    start() {
      for(let i=0; i<150; i++) this.particles.push(this.createParticle());
      this.animate();
    }
    animate() {
      this.ctx.clearRect(0, 0, this.width, this.height);
      this.particles.forEach((p, i) => {
        p.y += p.speedY;
        p.opacity -= p.decay;
        if (p.opacity <= 0) {
          this.particles[i] = this.createParticle();
        }
        this.ctx.fillStyle = `rgba(${this.hexToRgb(p.color)},${p.opacity})`;
        this.ctx.beginPath();
        this.ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        this.ctx.fill();
      });
      this.animFrame = requestAnimationFrame(this.animate.bind(this));
    }
    stop() {
      cancelAnimationFrame(this.animFrame);
      this.ctx.clearRect(0,0,this.width,this.height);
      this.particles = [];
    }
    hexToRgb(hex) {
      hex = hex.replace('#','');
      const bigint = parseInt(hex,16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return `${r},${g},${b}`;
    }
  }

  // Vocabulary data for 14 lessons (sample for 2 lessons shown; add more as needed)
  const lessons = [
  {
    name: "Lesson 1",
    words: [
      {english: "minute", japanese: "ÂàÜ"},
      {english: "before", japanese: "„ÅÆÂâç„Å´"},
      {english: "photography", japanese: "ÂÜôÁúüÊíÆÂΩ±"},
      {english: "tournament", japanese: "„Éà„Éº„Éä„É°„É≥„Éà"},
      {english: "against", japanese: "„Å´ÂØæÊäó„Åó„Å¶"},
      {english: "lost", japanese: "Ë≤†„Åë„Å£„Åü"},
      {english: "lose", japanese: "Ë≤†„Åë„Çã"},
      {english: "final", japanese: "ÊúÄÂæå„ÅÆ"},
      {english: "second", japanese: "Áßí"},
      {english: "broke", japanese: "Â£ä„Åó„Åü"},
      {english: "surely", japanese: "Á¢∫„Åã„Å´"},
      {english: "until", japanese: "„ÄÇ„ÄÇ„ÄÇ„Åæ„Åß"},
      {english: "half", japanese: "ÂçäÂàÜ„ÅÆ"},
      {english: "hour", japanese: "ÔºëÊôÇÈñì"},
      {english: "tomorrow", japanese: "ÊòéÊó•"},
      {english: "today", japanese: "‰ªäÊó•"},
      {english: "yesterday", japanese: "Êò®Êó•"},
      {english: "ago", japanese: "ÔΩûÂâç„Å´"},
      {english: "spread", japanese: "Â∫É„ÇÅ„Çã"},
      {english: "stadium", japanese: "„Çπ„Çø„Ç∏„Ç¢„É†"}
    ]
  },
  {
    name: "Lesson 2",
    words: [
      {english: "delicious", japanese: "„Åä„ÅÑ„Åó„ÅÑ"},
      {english: "happy", japanese: "Âπ∏„Åõ"},
      {english: "run", japanese: "Ëµ∞„Çã"},
      {english: "draw", japanese: "Êèè„Åè"},
      {english: "build", japanese: "Âª∫„Å¶„Çã"},
      {english: "carry", japanese: "ÈÅã„Å∂"},
      {english: "open", japanese: "Èñã„Åë„Çã"},
      {english: "close", japanese: "Èñâ„Åò„Çã"},
      {english: "wake up", japanese: "ÁõÆ„ÇíË¶ö„Åæ„Åô"},
      {english: "sleep", japanese: "Áú†„Çã"},
      {english: "stand", japanese: "Á´ã„Å§"},
      {english: "sit", japanese: "Â∫ß„Çã"},
      {english: "jump", japanese: "Ë∑≥„Å∂"},
      {english: "swim", japanese: "Ê≥≥„Åê"},
      {english: "drive", japanese: "ÈÅãËª¢„Åô„Çã"},
      {english: "listen", japanese: "ËÅû„Åè"},
      {english: "write", japanese: "Êõ∏„Åè"},
      {english: "read", japanese: "Ë™≠„ÇÄ"},
      {english: "speak", japanese: "Ë©±„Åô"},
      {english: "learn", japanese: "Â≠¶„Å∂"}
    ]
  },
  {
    name: "Lesson 3",
    words: [
      {english: "teacher", japanese: "ÂÖàÁîü"},
      {english: "student", japanese: "ÁîüÂæí"},
      {english: "classroom", japanese: "ÊïôÂÆ§"},
      {english: "library", japanese: "Âõ≥Êõ∏È§®"},
      {english: "desk", japanese: "Êú∫"},
      {english: "chair", japanese: "Ê§ÖÂ≠ê"},
      {english: "blackboard", japanese: "ÈªíÊùø"},
      {english: "homework", japanese: "ÂÆøÈ°å"},
      {english: "test", japanese: "„ÉÜ„Çπ„Éà"},
      {english: "question", japanese: "Ë≥™Âïè"},
      {english: "answer", japanese: "Á≠î„Åà"},
      {english: "listen", japanese: "ËÅû„Åè"},
      {english: "read", japanese: "Ë™≠„ÇÄ"},
      {english: "write", japanese: "Êõ∏„Åè"},
      {english: "speak", japanese: "Ë©±„Åô"},
      {english: "understand", japanese: "ÁêÜËß£„Åô„Çã"},
      {english: "learn", japanese: "Â≠¶„Å∂"},
      {english: "practice", japanese: "Á∑¥Áøí„Åô„Çã"},
      {english: "study", japanese: "ÂãâÂº∑„Åô„Çã"},
      {english: "remember", japanese: "Ë¶ö„Åà„Çã"}
    ]
  },
  {
    name: "Lesson 4",
    words: [
      {english: "apple", japanese: "„Çä„Çì„Åî"},
      {english: "banana", japanese: "„Éê„Éä„Éä"},
      {english: "grape", japanese: "„Å∂„Å©„ÅÜ"},
      {english: "orange", japanese: "„Ç™„É¨„É≥„Ç∏"},
      {english: "watermelon", japanese: "„Çπ„Ç§„Ç´"},
      {english: "strawberry", japanese: "„ÅÑ„Å°„Åî"},
      {english: "peach", japanese: "„ÇÇ„ÇÇ"},
      {english: "pineapple", japanese: "„Éë„Ç§„Éä„ÉÉ„Éó„É´"},
      {english: "cherry", japanese: "„Åï„Åè„Çâ„Çì„Åº"},
      {english: "melon", japanese: "„É°„É≠„É≥"},
      {english: "pear", japanese: "„Å™„Åó"},
      {english: "lemon", japanese: "„É¨„É¢„É≥"},
      {english: "mango", japanese: "„Éû„É≥„Ç¥„Éº"},
      {english: "blueberry", japanese: "„Éñ„É´„Éº„Éô„É™„Éº"},
      {english: "kiwi", japanese: "„Ç≠„Ç¶„Ç§"},
      {english: "coconut", japanese: "„Ç≥„Ç≥„Éä„ÉÉ„ÉÑ"},
      {english: "fig", japanese: "„ÅÑ„Å°„Åò„Åè"},
      {english: "date", japanese: "„Å™„Å§„ÇÅ„ÇÑ„Åó"},
      {english: "papaya", japanese: "„Éë„Éë„Ç§„É§"},
      {english: "plum", japanese: "„ÅÜ„ÇÅ"}
    ]
  },
  {
    name: "Lesson 5",
    words: [
      {english: "cat", japanese: "Áå´"},
      {english: "dog", japanese: "Áä¨"},
      {english: "bird", japanese: "È≥•"},
      {english: "fish", japanese: "È≠ö"},
      {english: "rabbit", japanese: "„ÅÜ„Åï„Åé"},
      {english: "horse", japanese: "È¶¨"},
      {english: "cow", japanese: "Áâõ"},
      {english: "pig", japanese: "Ë±ö"},
      {english: "sheep", japanese: "Áæä"},
      {english: "chicken", japanese: "È∂è"},
      {english: "duck", japanese: "„Ç¢„Éí„É´"},
      {english: "turtle", japanese: "‰∫Ä"},
      {english: "frog", japanese: "„Ç´„Ç®„É´"},
      {english: "lion", japanese: "„É©„Ç§„Ç™„É≥"},
      {english: "tiger", japanese: "„Éà„É©"},
      {english: "elephant", japanese: "Ë±°"},
      {english: "bear", japanese: "„ÇØ„Éû"},
      {english: "monkey", japanese: "„Çµ„É´"},
      {english: "wolf", japanese: "„Ç™„Ç™„Ç´„Éü"},
      {english: "fox", japanese: "„Ç≠„ÉÑ„Éç"}
    ]
  },
  {
    name: "Lesson 6",
    words: [
      {english: "car", japanese: "Ëªä"},
      {english: "bicycle", japanese: "Ëá™Ëª¢Ëªä"},
      {english: "bus", japanese: "„Éê„Çπ"},
      {english: "train", japanese: "ÈõªËªä"},
      {english: "airplane", japanese: "È£õË°åÊ©ü"},
      {english: "boat", japanese: "„Éú„Éº„Éà"},
      {english: "truck", japanese: "„Éà„É©„ÉÉ„ÇØ"},
      {english: "motorcycle", japanese: "„Ç™„Éº„Éà„Éê„Ç§"},
      {english: "subway", japanese: "Âú∞‰∏ãÈâÑ"},
      {english: "taxi", japanese: "„Çø„ÇØ„Ç∑„Éº"},
      {english: "helicopter", japanese: "„Éò„É™„Ç≥„Éó„Çø„Éº"},
      {english: "scooter", japanese: "„Çπ„ÇØ„Éº„Çø„Éº"},
      {english: "van", japanese: "„Éê„É≥"},
      {english: "tram", japanese: "Ë∑ØÈù¢ÈõªËªä"},
      {english: "ferry", japanese: "„Éï„Çß„É™„Éº"},
      {english: "cruise", japanese: "„ÇØ„É´„Éº„Ç∫"},
      {english: "rocket", japanese: "„É≠„Ç±„ÉÉ„Éà"},
      {english: "skateboard", japanese: "„Çπ„Ç±„Éº„Éà„Éú„Éº„Éâ"},
      {english: "rollerblades", japanese: "„É≠„Éº„É©„Éº„Éñ„É¨„Éº„Éâ"},
      {english: "hoverboard", japanese: "„Éõ„Éê„Éº„Éú„Éº„Éâ"}
    ]
  },
  {
    name: "Lesson 7",
    words: [
      {english: "red", japanese: "Ëµ§"},
      {english: "blue", japanese: "Èùí"},
      {english: "green", japanese: "Á∑ë"},
      {english: "yellow", japanese: "ÈªÑËâ≤"},
      {english: "black", japanese: "Èªí"},
      {english: "white", japanese: "ÁôΩ"},
      {english: "pink", japanese: "„Éî„É≥„ÇØ"},
      {english: "orange", japanese: "„Ç™„É¨„É≥„Ç∏"},
      {english: "purple", japanese: "Á¥´"},
      {english: "brown", japanese: "Ëå∂Ëâ≤"},
      {english: "gray", japanese: "ÁÅ∞Ëâ≤"},
      {english: "gold", japanese: "ÈáëËâ≤"},
      {english: "silver", japanese: "ÈäÄËâ≤"},
      {english: "beige", japanese: "„Éô„Éº„Ç∏„É•"},
      {english: "turquoise", japanese: "„Çø„Éº„Ç≥„Ç§„Ç∫"},
      {english: "navy", japanese: "„Éç„Ç§„Éì„Éº"},
      {english: "lavender", japanese: "„É©„Éô„É≥„ÉÄ„Éº"},
      {english: "maroon", japanese: "„Éû„É´„Éº„É≥"},
      {english: "teal", japanese: "„ÉÜ„Ç£„Éº„É´"},
      {english: "magenta", japanese: "„Éû„Çº„É≥„Çø"}
    ]
  },
  {
    name: "Lesson 8",
    words: [
      {english: "happy", japanese: "Âπ∏„Åõ"},
      {english: "sad", japanese: "ÊÇ≤„Åó„ÅÑ"},
      {english: "angry", japanese: "ÊÄí„Å£„Å¶„ÅÑ„Çã"},
      {english: "tired", japanese: "Áñ≤„Çå„Åü"},
      {english: "excited", japanese: "ËààÂ•Æ„Åó„Å¶„ÅÑ„Çã"},
      {english: "nervous", japanese: "Á∑äÂºµ„Åó„Å¶„ÅÑ„Çã"},
      {english: "scared", japanese: "ÊÄñ„ÅÑ"},
      {english: "bored", japanese: "ÈÄÄÂ±à„Åó„Å¶„ÅÑ„Çã"},
      {english: "surprised", japanese: "È©ö„ÅÑ„Åü"},
      {english: "proud", japanese: "Ë™á„Çä„Å´ÊÄù„ÅÜ"},
      {english: "calm", japanese: "ËêΩ„Å°ÁùÄ„ÅÑ„Åü"},
      {english: "confused", japanese: "Ê∑∑‰π±„Åó„Åü"},
      {english: "jealous", japanese: "Â´âÂ¶¨„Åó„Å¶„ÅÑ„Çã"},
      {english: "lonely", japanese: "Â≠§Áã¨"},
      {english: "relaxed", japanese: "„É™„É©„ÉÉ„ÇØ„Çπ„Åó„Åü"},
      {english: "hopeful", japanese: "Â∏åÊúõ„Å´Ê∫Ä„Å°„Åü"},
      {english: "grateful", japanese: "ÊÑüË¨ù„Åó„Å¶„ÅÑ„Çã"},
      {english: "shy", japanese: "ÊÅ•„Åö„Åã„Åó„Åå„ÇäÂ±ã"},
      {english: "friendly", japanese: "ÂèãÂ•ΩÁöÑ„Å™"},
      {english: "kind", japanese: "Ë¶™Âàá„Å™"}
    ]
  },
  {
    name: "Lesson 9",
    words: [
      {english: "Monday", japanese: "ÊúàÊõúÊó•"},
      {english: "Tuesday", japanese: "ÁÅ´ÊõúÊó•"},
      {english: "Wednesday", japanese: "Ê∞¥ÊõúÊó•"},
      {english: "Thursday", japanese: "Êú®ÊõúÊó•"},
      {english: "Friday", japanese: "ÈáëÊõúÊó•"},
      {english: "Saturday", japanese: "ÂúüÊõúÊó•"},
      {english: "Sunday", japanese: "Êó•ÊõúÊó•"},
      {english: "week", japanese: "ÈÄ±"},
      {english: "month", japanese: "Êúà"},
      {english: "year", japanese: "Âπ¥"},
      {english: "today", japanese: "‰ªäÊó•"},
      {english: "tomorrow", japanese: "ÊòéÊó•"},
      {english: "yesterday", japanese: "Êò®Êó•"},
      {english: "holiday", japanese: "‰ºëÊó•"},
      {english: "season", japanese: "Â≠£ÁØÄ"},
      {english: "spring", japanese: "Êò•"},
      {english: "summer", japanese: "Â§è"},
      {english: "autumn", japanese: "Áßã"},
      {english: "winter", japanese: "ÂÜ¨"},
      {english: "calendar", japanese: "„Ç´„É¨„É≥„ÉÄ„Éº"}
    ]
  },
  {
    name: "Lesson 10",
    words: [
      {english: "food", japanese: "È£ü„ÅπÁâ©"},
      {english: "water", japanese: "Ê∞¥"},
      {english: "bread", japanese: "„Éë„É≥"},
      {english: "rice", japanese: "„ÅîÈ£Ø"},
      {english: "meat", japanese: "ËÇâ"},
      {english: "fish", japanese: "È≠ö"},
      {english: "vegetables", japanese: "ÈáéËèú"},
      {english: "fruit", japanese: "ÊûúÁâ©"},
      {english: "soup", japanese: "„Çπ„Éº„Éó"},
      {english: "salad", japanese: "„Çµ„É©„ÉÄ"},
      {english: "dessert", japanese: "„Éá„Ç∂„Éº„Éà"},
      {english: "coffee", japanese: "„Ç≥„Éº„Éí„Éº"},
      {english: "tea", japanese: "„ÅäËå∂"},
      {english: "milk", japanese: "Áâõ‰π≥"},
      {english: "juice", japanese: "„Ç∏„É•„Éº„Çπ"},
      {english: "breakfast", japanese: "ÊúùÈ£ü"},
      {english: "lunch", japanese: "ÊòºÈ£ü"},
      {english: "dinner", japanese: "Â§ïÈ£ü"},
      {english: "snack", japanese: "„Åä„ÇÑ„Å§"},
      {english: "restaurant", japanese: "„É¨„Çπ„Éà„É©„É≥"}
    ]
  },
  {
    name: "Lesson 11",
    words: [
      {english: "family", japanese: "ÂÆ∂Êóè"},
      {english: "mother", japanese: "ÊØç"},
      {english: "father", japanese: "Áà∂"},
      {english: "brother", japanese: "ÂÖÑÂºü"},
      {english: "sister", japanese: "ÂßâÂ¶π"},
      {english: "grandmother", japanese: "Á•ñÊØç"},
      {english: "grandfather", japanese: "Á•ñÁà∂"},
      {english: "uncle", japanese: "„Åä„Åò"},
      {english: "aunt", japanese: "„Åä„Å∞"},
      {english: "cousin", japanese: "„ÅÑ„Å®„Åì"},
      {english: "child", japanese: "Â≠ê‰æõ"},
      {english: "baby", japanese: "Ëµ§„Å°„ÇÉ„Çì"},
      {english: "husband", japanese: "Â§´"},
      {english: "wife", japanese: "Â¶ª"},
      {english: "parent", japanese: "Ë¶™"},
      {english: "relative", japanese: "Ë¶™Êàö"},
      {english: "neighbor", japanese: "Èö£‰∫∫"},
      {english: "friend", japanese: "ÂèãÈÅî"},
      {english: "teacher", japanese: "ÂÖàÁîü"},
      {english: "student", japanese: "Â≠¶Áîü"}
    ]
  },
  {
    name: "Lesson 12",
    words: [
      {english: "school", japanese: "Â≠¶Ê†°"},
      {english: "class", japanese: "„ÇØ„É©„Çπ"},
      {english: "teacher", japanese: "ÂÖàÁîü"},
      {english: "student", japanese: "Â≠¶Áîü"},
      {english: "lesson", japanese: "ÊéàÊ•≠"},
      {english: "homework", japanese: "ÂÆøÈ°å"},
      {english: "test", japanese: "„ÉÜ„Çπ„Éà"},
      {english: "book", japanese: "Êú¨"},
      {english: "notebook", japanese: "„Éé„Éº„Éà"},
      {english: "pen", japanese: "„Éö„É≥"},
      {english: "pencil", japanese: "ÈâõÁ≠Ü"},
      {english: "eraser", japanese: "Ê∂à„Åó„Ç¥„É†"},
      {english: "desk", japanese: "Êú∫"},
      {english: "chair", japanese: "Ê§ÖÂ≠ê"},
      {english: "blackboard", japanese: "ÈªíÊùø"},
      {english: "library", japanese: "Âõ≥Êõ∏È§®"},
      {english: "computer", japanese: "„Ç≥„É≥„Éî„É•„Éº„Çø„Éº"},
      {english: "teacher", japanese: "ÊïôÂ∏´"},
      {english: "student", japanese: "ÁîüÂæí"},
      {english: "grade", japanese: "ÊàêÁ∏æ"}
    ]
  },
  {
    name: "Lesson 13",
    words: [
      {english: "weather", japanese: "Â§©Ê∞ó"},
      {english: "sunny", japanese: "Êô¥„Çå"},
      {english: "rainy", japanese: "Èõ®"},
      {english: "cloudy", japanese: "Êõá„Çä"},
      {english: "snowy", japanese: "Èõ™"},
      {english: "windy", japanese: "È¢®„ÅåÂº∑„ÅÑ"},
      {english: "hot", japanese: "Êöë„ÅÑ"},
      {english: "cold", japanese: "ÂØí„ÅÑ"},
      {english: "storm", japanese: "Âµê"},
      {english: "temperature", japanese: "Ê∞óÊ∏©"},
      {english: "season", japanese: "Â≠£ÁØÄ"},
      {english: "spring", japanese: "Êò•"},
      {english: "summer", japanese: "Â§è"},
      {english: "autumn", japanese: "Áßã"},
      {english: "winter", japanese: "ÂÜ¨"},
      {english: "foggy", japanese: "Èúß„Åå„Åã„Åã„Å£„Åü"},
      {english: "hail", japanese: "Èõπ"},
      {english: "thunder", japanese: "Èõ∑"},
      {english: "lightning", japanese: "Á®≤Â¶ª"},
      {english: "humidity", japanese: "ÊπøÂ∫¶"}
    ]
  },
  {
    name: "Lesson 14",
    words: [
      {english: "family", japanese: "ÂÆ∂Êóè"},
      {english: "friend", japanese: "ÂèãÈÅî"},
      {english: "love", japanese: "ÊÑõ"},
      {english: "hate", japanese: "ÊÜé„Åó„Åø"},
      {english: "joy", japanese: "Âñú„Å≥"},
      {english: "sadness", japanese: "ÊÇ≤„Åó„Åø"},
      {english: "anger", japanese: "ÊÄí„Çä"},
      {english: "fear", japanese: "ÊÅê„Çå"},
      {english: "hope", japanese: "Â∏åÊúõ"},
      {english: "peace", japanese: "Âπ≥Âíå"},
      {english: "trust", japanese: "‰ø°È†º"},
      {english: "dream", japanese: "Â§¢"},
      {english: "luck", japanese: "ÈÅã"},
      {english: "success", japanese: "ÊàêÂäü"},
      {english: "failure", japanese: "Â§±Êïó"},
      {english: "courage", japanese: "ÂãáÊ∞ó"},
      {english: "honesty", japanese: "Ê≠£Áõ¥"},
      {english: "kindness", japanese: "Ë¶™Âàá"},
      {english: "patience", japanese: "ÂøçËÄê"},
      {english: "wisdom", japanese: "Áü•ÊÅµ"}
    ]
  }
];

  // Elements references
  const lessonButtons = document.getElementById('lesson-buttons');
  const startMenu = document.getElementById('start-menu');
  const gameContainer = document.getElementById('game-container');
  const gameGrid = document.getElementById('game-grid');
  const progressBar = document.getElementById('progress-bar');
  const streakCounter = document.getElementById('streak-counter');
  const endScreen = document.getElementById('end-screen');
  const endTitle = document.getElementById('end-title');
  const endSummary = document.getElementById('end-summary');
  const endScore = document.getElementById('end-score');
  const restartBtn = document.getElementById('restart-btn');
  const backToMenuBtn = document.getElementById('back-to-menu-btn');
  const challengeBtn = document.getElementById('challenge-btn');
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const confettiCanvas = document.getElementById('confetti-canvas');
  const confetti = new Confetti(confettiCanvas);

  let currentLesson = null;
  let pairsMatched = 0;
  let totalPairs = 0;
  let streak = 0;
  let challengeMode = false;
  let challengeTimer = null;
  let challengeTimeLeft = 120; // seconds

  // Audio synthesis for English words
  function speak(word) {
    if (!window.speechSynthesis) return;
    const utterance = new SpeechSynthesisUtterance(word);
    utterance.lang = 'en-US';
    speechSynthesis.cancel();
    speechSynthesis.speak(utterance);
  }

  // Setup lesson buttons
  function setupLessonButtons() {
    lessonButtons.innerHTML = '';
    lessons.forEach((lesson, i) => {
      const btn = document.createElement('button');
      btn.textContent = lesson.name;
      btn.addEventListener('click', () => startGame(i, false));
      lessonButtons.appendChild(btn);
    });
  }

  // Start game with lesson index and challenge mode flag
  function startGame(index, isChallenge) {
    currentLesson = lessons[index];
    challengeMode = !!isChallenge;
    pairsMatched = 0;
    streak = 0;
    updateStreakDisplay();
    startMenu.style.display = 'none';
    endScreen.style.display = 'none';
    gameContainer.style.display = 'block';
    gameGrid.innerHTML = '';
    progressBar.style.width = '0%';

    const shuffledEnglish = shuffleArray(currentLesson.words.map(w => w.english));
    const shuffledJapanese = shuffleArray(currentLesson.words.map(w => w.japanese));

    totalPairs = currentLesson.words.length;

    // Create English draggable boxes
    shuffledEnglish.forEach(word => {
      const div = document.createElement('div');
      div.className = 'draggable';
      div.textContent = word;
      div.setAttribute('draggable', true);
      div.dataset.word = word;
      addDragAndTouchHandlers(div);
      gameGrid.appendChild(div);
    });

    // Create Japanese droppable boxes
    shuffledJapanese.forEach(word => {
      const div = document.createElement('div');
      div.className = 'droppable';
      div.textContent = word;
      const pair = currentLesson.words.find(w => w.japanese === word);
      div.dataset.match = pair ? pair.english : '';
      gameGrid.appendChild(div);
    });

    if (challengeMode) {
      startChallengeTimer();
    } else {
      stopChallengeTimer();
    }
  }

  // Shuffle helper
  function shuffleArray(arr) {
    const copy = arr.slice();
    for (let i = copy.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [copy[i], copy[j]] = [copy[j], copy[i]];
    }
    return copy;
  }

  // Update progress bar
  function updateProgress() {
    const percent = (pairsMatched / totalPairs) * 100;
    progressBar.style.width = percent + '%';
  }

  // Update streak display
  function updateStreakDisplay() {
    if (streak >= 3) {
      streakCounter.innerHTML = `üî• Streak: <span class="sparkle">${streak}</span>`;
    } else if (streak > 0) {
      streakCounter.textContent = `Streak: ${streak}`;
    } else {
      streakCounter.textContent = '';
    }
  }
  // Add drag and touch event listeners to English draggable divs
  function addDragAndTouchHandlers(div) {
    // Mouse drag
    div.addEventListener('dragstart', dragStart);
    div.addEventListener('dragend', dragEnd);

    // Touch drag
    div.addEventListener('touchstart', touchStart, {passive:false});
  }

  let draggedElement = null;
  let originalX = 0;
  let originalY = 0;
  let offsetX = 0;
  let offsetY = 0;

  function dragStart(e) {
    draggedElement = e.target;
    speak(draggedElement.textContent);
    e.dataTransfer.setData('text/plain', draggedElement.dataset.word);
    setTimeout(() => {
      draggedElement.classList.add('hide');
    }, 0);
  }

  function dragEnd(e) {
    if (draggedElement) {
      draggedElement.classList.remove('hide');
      draggedElement.style.position = '';
      draggedElement.style.zIndex = '';
      draggedElement.style.left = '';
      draggedElement.style.top = '';
      draggedElement = null;
    }
  }

  gameGrid.addEventListener('dragover', e => {
    e.preventDefault();
  });

  gameGrid.addEventListener('drop', e => {
    e.preventDefault();
    if (!draggedElement) return;
    const dropTarget = e.target.closest('.droppable');
    if (!dropTarget) return;
    const draggedWord = draggedElement.dataset.word;
    if (dropTarget.dataset.match === draggedWord) {
      onCorrectMatch(draggedElement, dropTarget);
    } else {
      onWrongMatch(draggedElement);
    }
  });

  // Touch drag functions
  function touchStart(e) {
    e.preventDefault();
    draggedElement = e.target;
    speak(draggedElement.textContent);
    draggedElement.style.position = 'absolute';
    draggedElement.style.zIndex = 1000;
    const touch = e.touches[0];
    originalX = draggedElement.offsetLeft;
    originalY = draggedElement.offsetTop;
    offsetX = touch.clientX - originalX;
    offsetY = touch.clientY - originalY;
    moveAt(touch.pageX, touch.pageY);
    document.addEventListener('touchmove', touchMove, {passive:false});
    document.addEventListener('touchend', touchEnd);
  }

  function moveAt(pageX, pageY) {
    if (!draggedElement) return;
    draggedElement.style.left = (pageX - offsetX) + 'px';
    draggedElement.style.top = (pageY - offsetY) + 'px';
  }

  function touchMove(e) {
    e.preventDefault();
    const touch = e.touches[0];
    moveAt(touch.pageX, touch.pageY);
  }

  function touchEnd(e) {
    e.preventDefault();
    const touch = e.changedTouches[0];
    const dropElem = document.elementFromPoint(touch.clientX, touch.clientY);
    if (dropElem && dropElem.classList.contains('droppable')) {
      const draggedWord = draggedElement.dataset.word;
      if (dropElem.dataset.match === draggedWord) {
        onCorrectMatch(draggedElement, dropElem);
      } else {
        onWrongMatch(draggedElement);
      }
    } else {
      onWrongMatch(draggedElement);
    }
    resetDraggedElement();
    document.removeEventListener('touchmove', touchMove);
    document.removeEventListener('touchend', touchEnd);
  }

  function resetDraggedElement() {
    if (!draggedElement) return;
    draggedElement.style.position = '';
    draggedElement.style.zIndex = '';
    draggedElement.style.left = '';
    draggedElement.style.top = '';
    draggedElement = null;
  }

  // Correct match handler
  function onCorrectMatch(dragEl, dropEl) {
    dropEl.classList.add('matched');
    dragEl.classList.add('matched');
    dragEl.setAttribute('draggable', 'false');
    dropEl.textContent = ''; // clear Japanese text
    dropEl.appendChild(dragEl);
    pairsMatched++;
    streak++;
    updateProgress();
    updateStreakDisplay();
    animateCorrectMatch(dragEl);
    checkGameComplete();
  }

  // Wrong match handler
  function onWrongMatch(dragEl) {
    streak = 0;
    updateStreakDisplay();
    animateWrongMatch(dragEl);
  }

  // Animate correct match (small sparkle effect)
  function animateCorrectMatch(el) {
    el.classList.add('sparkle');
    setTimeout(() => {
      el.classList.remove('sparkle');
    }, 1200);
  }

  // Animate wrong match (red flash + bounce)
  function animateWrongMatch(el) {
    el.classList.add('flash-red');
    el.classList.add('bounce');
    setTimeout(() => {
      el.classList.remove('flash-red');
      el.classList.remove('bounce');
    }, 600);
  }

  // Check if all pairs matched
  function checkGameComplete() {
    if (pairsMatched === totalPairs) {
      showEndScreen(true);
    }
  }
  // Show end screen
  function showEndScreen(won) {
    confetti.start();
    setTimeout(() => confetti.stop(), 6000);
    gameContainer.style.display = 'none';
    endScreen.style.display = 'block';
    if (won) {
      endTitle.textContent = "üéâ Congratulations! üéâ";
      endSummary.textContent = `You matched all ${totalPairs} pairs!`;
    } else {
      endTitle.textContent = "‚è∞ Time's Up!";
      endSummary.textContent = `You matched ${pairsMatched} out of ${totalPairs} pairs.`;
    }
    endScore.textContent = `Final Score: ${pairsMatched}`;
  }

  // Restart buttons
  restartBtn.addEventListener('click', () => {
    startGame(lessons.indexOf(currentLesson), challengeMode);
  });

  backToMenuBtn.addEventListener('click', () => {
    endScreen.style.display = 'none';
    startMenu.style.display = 'flex';
    stopChallengeTimer();
  });

  challengeBtn.addEventListener('click', () => {
    startGame(0, true);
  });

  // Challenge mode timer
  const progressContainer = document.getElementById('progress-container');
  function startChallengeTimer() {
    challengeTimeLeft = 120;
    progressContainer.style.display = 'block';
    progressBar.style.backgroundColor = '#e74c3c';
    updateChallengeProgress();
    challengeTimer = setInterval(() => {
      challengeTimeLeft--;
      updateChallengeProgress();
      if (challengeTimeLeft <= 0) {
        clearInterval(challengeTimer);
        showEndScreen(false);
      }
    }, 1000);
  }

  function updateChallengeProgress() {
    const percent = (challengeTimeLeft / 120) * 100;
    progressBar.style.width = percent + '%';
  }

  function stopChallengeTimer() {
    if (challengeTimer) {
      clearInterval(challengeTimer);
      challengeTimer = null;
    }
    progressContainer.style.display = 'none';
    progressBar.style.width = '0%';
  }

  // Dark mode toggle
  darkModeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
  });

  // Initialize
  setupLessonButtons();
</script>
</body>
</html>
